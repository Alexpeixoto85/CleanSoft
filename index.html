<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4361ee">
    <title>CleanSoft Mobile Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* ===== VARIÁVEIS ATUALIZADAS ===== */
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --success-dark: #3a86ff;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f7fa;
            color: var(--dark);
            line-height: 1.5;
            min-height: 100vh;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* ===== HEADER SIMPLIFICADO ===== */
        .app-header {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            padding: 20px 20px 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .date-time {
            text-align: right;
        }

        .date-time .date {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .date-time .time {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .page-title {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 10px 0;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ===== NAVEGAÇÃO INFERIOR ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 5px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid var(--light-gray);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            transition: var(--transition);
            flex: 1;
            max-width: 70px;
        }

        .nav-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: var(--transition);
            background: var(--light-gray);
            margin-bottom: 6px;
        }

        .nav-item span {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }

        /* ===== CONTEÚDO PRINCIPAL ===== */
        .main-content {
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .card-header h2 {
            font-size: 1.3rem;
            color: var(--dark);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ===== STATS GRID ATUALIZADO ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px 15px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }

        .stat-info h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-weight: 800;
            color: var(--dark);
        }

        .stat-info p {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
        }

        /* ===== BOTÕES ===== */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4cc9f0, #4895ef);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f72585, #b5179e);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f8961e, #f3722c);
            color: white;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #FF6B6B, #EE5A52);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* ===== LISTAS ===== */
        .list {
            list-style: none;
        }

        .list-item {
            padding: 18px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            background: white;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            background: #f8f9ff;
        }

        .list-item-content h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .list-item-content p {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .list-item-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light-gray);
            border: none;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
        }

        .icon-btn:hover {
            background: var(--primary);
            color: white;
        }

        .icon-btn.whatsapp:hover {
            background: #25D366;
            color: white;
        }

        .icon-btn.pdf:hover {
            background: #FF6B6B;
            color: white;
        }

        /* ===== FORMULÁRIOS ===== */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* ===== MODAL ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 15px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.4rem;
            color: var(--dark);
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--light-gray);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 2px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* ===== BOTÃO FLUTUANTE ===== */
        .fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
            border: none;
            cursor: pointer;
            z-index: 999;
            transition: var(--transition);
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* ===== BUSCA ===== */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            font-size: 1rem;
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* ===== STATUS ===== */
        .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pendente {
            background: rgba(248, 150, 30, 0.1);
            color: #f8961e;
        }

        .status-aprovado {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }

        .status-concluido {
            background: rgba(67, 97, 238, 0.1);
            color: #4361ee;
        }

        .status-cancelado {
            background: rgba(247, 37, 133, 0.1);
            color: #f72585;
        }

        .status-andamento {
            background: rgba(114, 9, 183, 0.1);
            color: #7209b7;
        }

        .status-agendado {
            background: rgba(72, 149, 239, 0.1);
            color: #4895ef;
        }

        .status-confirmado {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }

        /* ===== NOTIFICAÇÕES ===== */
        .toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            font-weight: 600;
            max-width: 90%;
            text-align: center;
            animation: slideDown 0.3s ease;
        }

        .toast.success {
            background: linear-gradient(135deg, #4cc9f0, #4895ef);
        }

        .toast.error {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .toast.warning {
            background: linear-gradient(135deg, #f8961e, #f3722c);
        }

        @keyframes slideDown {
            from { top: 80px; opacity: 0; }
            to { top: 100px; opacity: 1; }
        }

        /* ===== IMPORT/EXPORT ===== */
        .backup-section {
            margin: 25px 0;
            padding: 20px;
            border-radius: var(--radius);
            background: #f8f9ff;
            border: 2px dashed var(--primary-light);
        }

        .backup-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        .backup-info {
            background: white;
            padding: 12px 15px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            border-left: 4px solid var(--primary);
        }

        /* ===== AÇÕES RÁPIDAS ===== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .action-btn {
            background: white;
            border-radius: var(--radius);
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            text-decoration: none;
            color: var(--dark);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: none;
            cursor: pointer;
        }

        .action-btn i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .action-btn span {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--light-gray);
            margin-bottom: 15px;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* ===== RESPONSIVO ===== */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-content {
                padding: 15px;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .fab {
                bottom: 80px;
                right: 15px;
            }
            
            .backup-buttons {
                grid-template-columns: 1fr;
            }
            
            .list-item-actions {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }

        /* ===== LOADING ===== */
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(67, 97, 238, 0.2);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== FILE INPUT ===== */
        .file-input-container {
            position: relative;
            margin: 15px 0;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-label {
            display: block;
            padding: 15px;
            background: white;
            border: 2px dashed var(--primary-light);
            border-radius: var(--radius-sm);
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .file-label:hover {
            background: #f8f9ff;
            border-color: var(--primary);
        }

        /* ===== PDF PREVIEW ===== */
        .pdf-preview {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }

        .pdf-header h2 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .pdf-info {
            margin: 15px 0;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .pdf-table th, .pdf-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .pdf-table th {
            background: #f8f9ff;
            color: var(--primary);
        }

        .pdf-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
            color: var(--gray);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Cabeçalho -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-spray-can"></i>
                </div>
                <div class="logo-text">
                    <h1>CleanSoft Pro</h1>
                    <p>Lavagem & Seco Premium</p>
                </div>
            </div>
            <div class="date-time">
                <div class="date" id="currentDate">--/--/----</div>
                <div class="time" id="currentTime">--:--</div>
            </div>
        </div>
        <div class="page-title">
            <i class="fas fa-home"></i>
            <span id="pageTitle">Dashboard</span>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="page active">
            <div class="stats-grid">
                <div class="stat-card" onclick="mostrarPagina('clientes')">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalClientes">0</h3>
                        <p>Clientes</p>
                    </div>
                </div>
                <div class="stat-card" onclick="mostrarPagina('financeiro')">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="receitaTotal">R$ 0</h3>
                        <p>Receita</p>
                    </div>
                </div>
                <div class="stat-card" onclick="mostrarPagina('ordens')">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalOrdens">0</h3>
                        <p>Ordens Ativas</p>
                    </div>
                </div>
                <div class="stat-card" onclick="mostrarPagina('agendamentos')">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalAgendamentos">0</h3>
                        <p>Agendamentos</p>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="action-btn" onclick="mostrarClienteForm()">
                    <i class="fas fa-user-plus"></i>
                    <span>Novo Cliente</span>
                </button>
                <button class="action-btn" onclick="mostrarOrcamentoForm()">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Novo Orçamento</span>
                </button>
                <button class="action-btn" onclick="mostrarOrdemForm()">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Nova Ordem</span>
                </button>
                <button class="action-btn" onclick="mostrarAgendamentoForm()">
                    <i class="fas fa-calendar-plus"></i>
                    <span>Novo Agendamento</span>
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Atividades Recentes</h2>
                </div>
                <ul class="list" id="recentActivities">
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>Nenhuma atividade</h3>
                        <p>As atividades aparecerão aqui</p>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Clientes -->
        <section id="clientes" class="page">
            <div class="search-box">
                <input type="text" id="searchCliente" class="search-input" placeholder="Buscar clientes...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-users"></i> Clientes</h2>
                    <button class="btn btn-primary" onclick="mostrarClienteForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaClientes">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum cliente</h3>
                        <p>Adicione seu primeiro cliente</p>
                        <button class="btn btn-primary" onclick="mostrarClienteForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Adicionar Cliente
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Orçamentos -->
        <section id="orcamentos" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Orçamentos</h2>
                    <button class="btn btn-primary" onclick="mostrarOrcamentoForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaOrcamentos">
                    <div class="empty-state">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h3>Nenhum orçamento</h3>
                        <p>Crie seu primeiro orçamento</p>
                        <button class="btn btn-primary" onclick="mostrarOrcamentoForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Criar Orçamento
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Ordens -->
        <section id="ordens" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-clipboard-list"></i> Ordens de Serviço</h2>
                    <button class="btn btn-primary" onclick="mostrarOrdemForm()">
                        <i class="fas fa-plus"></i> Nova
                    </button>
                </div>
                <ul class="list" id="listaOrdens">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Nenhuma ordem</h3>
                        <p>Crie sua primeira ordem</p>
                        <button class="btn btn-primary" onclick="mostrarOrdemForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Criar Ordem
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Agendamentos -->
        <section id="agendamentos" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-calendar-alt"></i> Agendamentos</h2>
                    <button class="btn btn-primary" onclick="mostrarAgendamentoForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaAgendamentos">
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Nenhum agendamento</h3>
                        <p>Agende seu primeiro serviço</p>
                        <button class="btn btn-primary" onclick="mostrarAgendamentoForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Agendar Serviço
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Financeiro -->
        <section id="financeiro" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-chart-line"></i> Financeiro</h2>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3 id="receitaMes">R$ 0</h3>
                            <p>Receita Mês</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3 id="pendentes">R$ 0</h3>
                            <p>Pendentes</p>
                        </div>
                    </div>
                </div>
                <div class="list" id="listaPendentes">
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Nenhum pendente</h3>
                        <p>Todos os pagamentos em dia!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configurações -->
        <section id="configuracoes" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-cog"></i> Configurações</h2>
                </div>
                <div class="form-group">
                    <label>Nome da Empresa</label>
                    <input type="text" id="empresaNome" class="form-control" placeholder="Digite o nome da empresa">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="empresaTelefone" class="form-control" placeholder="(11) 99999-9999">
                </div>
                <div class="form-group">
                    <label>WhatsApp para Envios</label>
                    <input type="tel" id="whatsappNumero" class="form-control" placeholder="5511999999999">
                    <small style="color: var(--gray);">Apenas números, com código do país (ex: 5511999999999)</small>
                </div>
                <button class="btn btn-primary" onclick="salvarConfiguracoes()" style="width: 100%;">
                    <i class="fas fa-save"></i> Salvar Configurações
                </button>
                
                <div class="backup-section">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">
                        <i class="fas fa-database"></i> Backup & Restauração
                    </h3>
                    <div class="backup-info">
                        <p><strong>Exportar:</strong> Salve todos os dados em um arquivo JSON</p>
                        <p><strong>Importar:</strong> Restaure dados a partir de um backup</p>
                    </div>
                    <div class="backup-buttons">
                        <button class="btn btn-success" onclick="exportarDados()">
                            <i class="fas fa-file-export"></i> Exportar Backup
                        </button>
                        <button class="btn btn-warning" onclick="mostrarImportarBackup()">
                            <i class="fas fa-file-import"></i> Importar Backup
                        </button>
                    </div>
                    <div class="file-input-container" style="display: none;" id="importContainer">
                        <input type="file" id="backupFile" class="file-input" accept=".json">
                        <label for="backupFile" class="file-label">
                            <i class="fas fa-upload"></i> Selecione o arquivo de backup
                        </label>
                    </div>
                </div>
                
                <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid var(--light-gray);">
                    <button class="btn btn-danger" onclick="limparDados()" style="width: 100%;">
                        <i class="fas fa-trash"></i> Limpar Todos os Dados
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Navegação Inferior -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="dashboard">
            <div class="nav-icon">
                <i class="fas fa-home"></i>
            </div>
            <span>Início</span>
        </a>
        <a href="#" class="nav-item" data-page="clientes">
            <div class="nav-icon">
                <i class="fas fa-users"></i>
            </div>
            <span>Clientes</span>
        </a>
        <a href="#" class="nav-item" data-page="orcamentos">
            <div class="nav-icon">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <span>Orçamentos</span>
        </a>
        <a href="#" class="nav-item" data-page="ordens">
            <div class="nav-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <span>Ordens</span>
        </a>
        <a href="#" class="nav-item" data-page="configuracoes">
            <div class="nav-icon">
                <i class="fas fa-cog"></i>
            </div>
            <span>Config</span>
        </a>
    </nav>

    <!-- Botão Flutuante -->
    <button class="fab" id="fab" style="display: none;">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Modal</h2>
                <button class="close-modal" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <script>
        // ===== SISTEMA CLEANSOFT PREMIUM =====
        
        // Banco de dados
        let db;
        let currentPage = 'dashboard';
        let editingId = null;
        let whatsappNumero = '';
        const { jsPDF } = window.jspdf;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            iniciarDB();
            atualizarDataHora();
            setInterval(atualizarDataHora, 60000);
            configurarNavegacao();
            configurarBusca();
            carregarDados();
            carregarConfiguracoes();
        });

        // ===== BANCO DE DADOS =====
        function iniciarDB() {
            const request = indexedDB.open('CleanSoftDB', 3);
            
            request.onerror = function(event) {
                console.error('Erro no banco de dados:', event.target.error);
                mostrarToast('Erro ao iniciar banco de dados', 'error');
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                console.log('Banco de dados pronto');
            };
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                
                if (!db.objectStoreNames.contains('clientes')) {
                    db.createObjectStore('clientes', { keyPath: 'id', autoIncrement: true });
                }
                
                if (!db.objectStoreNames.contains('orcamentos')) {
                    db.createObjectStore('orcamentos', { keyPath: 'id', autoIncrement: true });
                }
                
                if (!db.objectStoreNames.contains('ordens')) {
                    db.createObjectStore('ordens', { keyPath: 'id', autoIncrement: true });
                }
                
                if (!db.objectStoreNames.contains('agendamentos')) {
                    db.createObjectStore('agendamentos', { keyPath: 'id', autoIncrement: true });
                }
                
                if (!db.objectStoreNames.contains('atividades')) {
                    db.createObjectStore('atividades', { keyPath: 'id', autoIncrement: true });
                }
                
                if (!db.objectStoreNames.contains('config')) {
                    db.createObjectStore('config', { keyPath: 'id' });
                }
            };
        }

        // ===== FUNÇÕES PRINCIPAIS =====
        function atualizarDataHora() {
            const agora = new Date();
            const data = agora.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: 'short' });
            const hora = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('currentDate').textContent = data;
            document.getElementById('currentTime').textContent = hora;
        }

        function configurarNavegacao() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remover classe active de todos
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    
                    // Adicionar ao item clicado
                    this.classList.add('active');
                    
                    // Mostrar página correspondente
                    const pagina = this.getAttribute('data-page');
                    mostrarPagina(pagina);
                    
                    // Atualizar título
                    document.getElementById('pageTitle').textContent = this.querySelector('span').textContent;
                    
                    // Configurar FAB
                    configurarFab(pagina);
                });
            });
        }

        function configurarBusca() {
            const busca = document.getElementById('searchCliente');
            if (busca) {
                busca.addEventListener('input', function() {
                    carregarClientes(this.value);
                });
            }
        }

        function mostrarPagina(pagina) {
            // Esconder todas as páginas
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Mostrar página solicitada
            const elemento = document.getElementById(pagina);
            if (elemento) {
                elemento.classList.add('active');
                currentPage = pagina;
                
                // Carregar dados específicos
                switch(pagina) {
                    case 'dashboard': carregarDashboard(); break;
                    case 'clientes': carregarClientes(); break;
                    case 'orcamentos': carregarOrcamentos(); break;
                    case 'ordens': carregarOrdens(); break;
                    case 'agendamentos': carregarAgendamentos(); break;
                    case 'financeiro': carregarFinanceiro(); break;
                }
            }
        }

        function configurarFab(pagina) {
            const fab = document.getElementById('fab');
            if (!fab) return;
            
            switch(pagina) {
                case 'clientes':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-user-plus"></i>';
                    fab.onclick = () => mostrarClienteForm();
                    break;
                case 'orcamentos':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-file-invoice-dollar"></i>';
                    fab.onclick = () => mostrarOrcamentoForm();
                    break;
                case 'ordens':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-clipboard-check"></i>';
                    fab.onclick = () => mostrarOrdemForm();
                    break;
                case 'agendamentos':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-calendar-plus"></i>';
                    fab.onclick = () => mostrarAgendamentoForm();
                    break;
                default:
                    fab.style.display = 'none';
            }
        }

        // ===== CARREGAR DADOS =====
        function carregarDados() {
            if (!db) {
                setTimeout(carregarDados, 100);
                return;
            }
            
            carregarDashboard();
            carregarClientes();
            carregarOrcamentos();
            carregarOrdens();
            carregarAgendamentos();
            carregarFinanceiro();
            carregarAtividades();
        }

        async function carregarDashboard() {
            if (!db) return;
            
            // Contar clientes
            const clientes = await obterTodos('clientes');
            document.getElementById('totalClientes').textContent = clientes.length;
            
            // Calcular receita total
            const ordens = await obterTodos('ordens');
            const receitaTotal = ordens
                .filter(o => o.status === 'concluido')
                .reduce((soma, ordem) => soma + (ordem.valor || 0), 0);
            
            document.getElementById('receitaTotal').textContent = 'R$ ' + receitaTotal.toFixed(2);
            
            // Contar ordens ativas
            const ordensAtivas = ordens.filter(o => o.status !== 'concluido' && o.status !== 'cancelado').length;
            document.getElementById('totalOrdens').textContent = ordensAtivas;
            
            // Contar agendamentos de hoje
            const agendamentos = await obterTodos('agendamentos');
            const hoje = new Date().toISOString().split('T')[0];
            const agendamentosHoje = agendamentos.filter(a => a.data === hoje && a.status !== 'cancelado').length;
            document.getElementById('totalAgendamentos').textContent = agendamentosHoje;
        }

        async function carregarClientes(busca = '') {
            if (!db) return;
            
            const clientes = await obterTodos('clientes');
            
            // Filtrar se houver busca
            let clientesFiltrados = clientes;
            if (busca) {
                const termo = busca.toLowerCase();
                clientesFiltrados = clientes.filter(c => 
                    c.nome.toLowerCase().includes(termo) ||
                    c.telefone.includes(busca) ||
                    (c.email && c.email.toLowerCase().includes(termo))
                );
            }
            
            mostrarClientes(clientesFiltrados);
        }

        function mostrarClientes(clientes) {
            const container = document.getElementById('listaClientes');
            if (!container) return;
            
            if (!clientes || clientes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>${document.getElementById('searchCliente')?.value ? 'Nenhum cliente encontrado' : 'Nenhum cliente'}</h3>
                        <p>${document.getElementById('searchCliente')?.value ? 'Tente outros termos' : 'Adicione seu primeiro cliente'}</p>
                        <button class="btn btn-primary" onclick="mostrarClienteForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Adicionar Cliente
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            clientes.forEach(cliente => {
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${cliente.nome}</h3>
                            <p><i class="fas fa-phone"></i> ${cliente.telefone}</p>
                            ${cliente.email ? `<p><i class="fas fa-envelope"></i> ${cliente.email}</p>` : ''}
                        </div>
                        <div class="list-item-actions">
                            <button class="icon-btn" onclick="editarCliente(${cliente.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn whatsapp" onclick="enviarWhatsApp('${cliente.telefone}', 'cliente')" title="WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===== CLIENTES =====
        function mostrarClienteForm(cliente = null) {
            editingId = cliente ? cliente.id : null;
            
            document.getElementById('modalTitle').textContent = cliente ? 'Editar Cliente' : 'Novo Cliente';
            
            const html = `
                <div class="form-group">
                    <label for="clienteNome">Nome *</label>
                    <input type="text" id="clienteNome" class="form-control" value="${cliente ? cliente.nome : ''}" placeholder="Nome completo" required>
                </div>
                
                <div class="form-group">
                    <label for="clienteTelefone">Telefone/WhatsApp *</label>
                    <input type="tel" id="clienteTelefone" class="form-control" value="${cliente ? cliente.telefone : ''}" placeholder="(11) 99999-9999" required>
                </div>
                
                <div class="form-group">
                    <label for="clienteEmail">E-mail</label>
                    <input type="email" id="clienteEmail" class="form-control" value="${cliente ? cliente.email || '' : ''}" placeholder="email@exemplo.com">
                </div>
                
                <div class="form-group">
                    <label for="clienteEndereco">Endereço</label>
                    <input type="text" id="clienteEndereco" class="form-control" value="${cliente ? cliente.endereco || '' : ''}" placeholder="Endereço completo">
                </div>
            `;
            
            const footer = `
                <button type="button" class="btn btn-danger" onclick="fecharModal()">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="salvarCliente()">Salvar</button>
            `;
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modalFooter').innerHTML = footer;
            
            abrirModal();
            
            setTimeout(() => document.getElementById('clienteNome').focus(), 300);
        }

        async function salvarCliente() {
            const nome = document.getElementById('clienteNome').value.trim();
            const telefone = document.getElementById('clienteTelefone').value.trim();
            const email = document.getElementById('clienteEmail').value.trim();
            const endereco = document.getElementById('clienteEndereco').value.trim();
            
            if (!nome || !telefone) {
                mostrarToast('Preencha nome e telefone', 'error');
                return;
            }
            
            const cliente = {
                nome,
                telefone,
                email,
                endereco,
                dataCadastro: new Date().toISOString(),
                status: 'ativo'
            };
            
            if (editingId) cliente.id = editingId;
            
            try {
                if (editingId) {
                    await atualizar('clientes', cliente);
                    mostrarToast('Cliente atualizado!', 'success');
                } else {
                    await adicionar('clientes', cliente);
                    mostrarToast('Cliente cadastrado!', 'success');
                }
                
                fecharModal();
                carregarClientes();
                carregarDashboard();
                adicionarAtividade(editingId ? 'Cliente atualizado' : 'Novo cliente', cliente.nome);
                
            } catch (error) {
                mostrarToast('Erro ao salvar cliente', 'error');
            }
        }

        async function editarCliente(id) {
            const cliente = await obterPorId('clientes', id);
            if (cliente) mostrarClienteForm(cliente);
        }

        // ===== ORÇAMENTOS =====
        async function mostrarOrcamentoForm(orcamento = null) {
            editingId = orcamento ? orcamento.id : null;
            
            const clientes = await obterTodos('clientes');
            const clientesOptions = clientes.map(c => 
                `<option value="${c.id}" ${orcamento && orcamento.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
            ).join('');
            
            document.getElementById('modalTitle').textContent = orcamento ? 'Editar Orçamento' : 'Novo Orçamento';
            
            const html = `
                <div class="form-group">
                    <label for="orcamentoCliente">Cliente *</label>
                    <select id="orcamentoCliente" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                        ${clientesOptions}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="orcamentoServicos">Serviços *</label>
                    <textarea id="orcamentoServicos" class="form-control" placeholder="Descreva os serviços" required rows="3">${orcamento ? orcamento.servicos : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="orcamentoValor">Valor (R$) *</label>
                    <input type="number" id="orcamentoValor" class="form-control" step="0.01" min="0" value="${orcamento ? orcamento.valor : ''}" placeholder="0,00" required>
                </div>
                
                <div class="form-group">
                    <label for="orcamentoValidade">Validade (dias)</label>
                    <input type="number" id="orcamentoValidade" class="form-control" min="1" value="${orcamento ? orcamento.validade || 7 : 7}">
                </div>
                
                <div class="form-group">
                    <label for="orcamentoStatus">Status</label>
                    <select id="orcamentoStatus" class="form-control">
                        <option value="pendente" ${orcamento && orcamento.status === 'pendente' ? 'selected' : 'selected'}>Pendente</option>
                        <option value="aprovado" ${orcamento && orcamento.status === 'aprovado' ? 'selected' : ''}>Aprovado</option>
                        <option value="cancelado" ${orcamento && orcamento.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                    </select>
                </div>
            `;
            
            const footer = `
                <button type="button" class="btn btn-danger" onclick="fecharModal()">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="salvarOrcamento()">Salvar</button>
                ${orcamento ? `
                    <button type="button" class="btn btn-pdf" onclick="gerarPDFOrcamento(${orcamento.id})">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button type="button" class="btn btn-whatsapp" onclick="enviarOrcamentoWhatsApp(${orcamento.id})">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                ` : ''}
            `;
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modalFooter').innerHTML = footer;
            
            abrirModal();
        }

        async function salvarOrcamento() {
            const clienteId = document.getElementById('orcamentoCliente').value;
            const servicos = document.getElementById('orcamentoServicos').value.trim();
            const valor = parseFloat(document.getElementById('orcamentoValor').value) || 0;
            const validade = parseInt(document.getElementById('orcamentoValidade').value) || 7;
            const status = document.getElementById('orcamentoStatus').value;
            
            if (!clienteId || !servicos || !valor) {
                mostrarToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', parseInt(clienteId));
            
            const orcamento = {
                clienteId: parseInt(clienteId),
                clienteNome: cliente ? cliente.nome : 'Cliente',
                clienteTelefone: cliente ? cliente.telefone : '',
                servicos,
                valor,
                validade,
                status,
                data: new Date().toISOString(),
                numero: 'ORC' + Date.now().toString().slice(-6)
            };
            
            if (editingId) orcamento.id = editingId;
            
            try {
                if (editingId) {
                    await atualizar('orcamentos', orcamento);
                    mostrarToast('Orçamento atualizado!', 'success');
                } else {
                    await adicionar('orcamentos', orcamento);
                    mostrarToast('Orçamento criado!', 'success');
                }
                
                fecharModal();
                carregarOrcamentos();
                adicionarAtividade(editingId ? 'Orçamento atualizado' : 'Novo orçamento', cliente?.nome);
                
            } catch (error) {
                mostrarToast('Erro ao salvar orçamento', 'error');
            }
        }

        async function carregarOrcamentos() {
            if (!db) return;
            
            const orcamentos = await obterTodos('orcamentos');
            const clientes = await obterTodos('clientes');
            
            const container = document.getElementById('listaOrcamentos');
            if (!container) return;
            
            if (!orcamentos || orcamentos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h3>Nenhum orçamento</h3>
                        <p>Crie seu primeiro orçamento</p>
                        <button class="btn btn-primary" onclick="mostrarOrcamentoForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Criar Orçamento
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            orcamentos.forEach(orcamento => {
                const cliente = clientes.find(c => c.id === orcamento.clienteId);
                const data = new Date(orcamento.data).toLocaleDateString('pt-BR');
                
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${orcamento.numero}</h3>
                            <p><i class="fas fa-user"></i> ${cliente ? cliente.nome : 'Cliente não encontrado'}</p>
                            <p><i class="fas fa-dollar-sign"></i> R$ ${orcamento.valor.toFixed(2)}</p>
                            <span class="status status-${orcamento.status}">${orcamento.status}</span>
                        </div>
                        <div class="list-item-actions">
                            <button class="icon-btn" onclick="editarOrcamento(${orcamento.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn pdf" onclick="gerarPDFOrcamento(${orcamento.id})" title="PDF">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="icon-btn whatsapp" onclick="enviarOrcamentoWhatsApp(${orcamento.id})" title="WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        async function editarOrcamento(id) {
            const orcamento = await obterPorId('orcamentos', id);
            if (orcamento) mostrarOrcamentoForm(orcamento);
        }

        // ===== ORDENS =====
        async function mostrarOrdemForm(ordem = null) {
            editingId = ordem ? ordem.id : null;
            
            const clientes = await obterTodos('clientes');
            const clientesOptions = clientes.map(c => 
                `<option value="${c.id}" ${ordem && ordem.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
            ).join('');
            
            document.getElementById('modalTitle').textContent = ordem ? 'Editar Ordem' : 'Nova Ordem';
            
            const hoje = new Date().toISOString().split('T')[0];
            const prazo = ordem ? ordem.dataPrazo : hoje;
            
            const html = `
                <div class="form-group">
                    <label for="ordemCliente">Cliente *</label>
                    <select id="ordemCliente" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                        ${clientesOptions}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ordemServicos">Serviços *</label>
                    <textarea id="ordemServicos" class="form-control" placeholder="Descreva os serviços" required rows="3">${ordem ? ordem.servicos : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="ordemValor">Valor (R$) *</label>
                    <input type="number" id="ordemValor" class="form-control" step="0.01" min="0" value="${ordem ? ordem.valor : ''}" placeholder="0,00" required>
                </div>
                
                <div class="form-group">
                    <label for="ordemStatus">Status</label>
                    <select id="ordemStatus" class="form-control">
                        <option value="pendente" ${ordem && ordem.status === 'pendente' ? 'selected' : 'selected'}>Pendente</option>
                        <option value="andamento" ${ordem && ordem.status === 'andamento' ? 'selected' : ''}>Em Andamento</option>
                        <option value="concluido" ${ordem && ordem.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                        <option value="cancelado" ${ordem && ordem.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ordemPrazo">Prazo</label>
                    <input type="date" id="ordemPrazo" class="form-control" value="${prazo}">
                </div>
            `;
            
            const footer = `
                <button type="button" class="btn btn-danger" onclick="fecharModal()">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="salvarOrdem()">Salvar</button>
                ${ordem ? `
                    <button type="button" class="btn btn-pdf" onclick="gerarPDFOrdem(${ordem.id})">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button type="button" class="btn btn-whatsapp" onclick="enviarOrdemWhatsApp(${ordem.id})">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                ` : ''}
            `;
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modalFooter').innerHTML = footer;
            
            abrirModal();
        }

        async function salvarOrdem() {
            const clienteId = document.getElementById('ordemCliente').value;
            const servicos = document.getElementById('ordemServicos').value.trim();
            const valor = parseFloat(document.getElementById('ordemValor').value) || 0;
            const status = document.getElementById('ordemStatus').value;
            const dataPrazo = document.getElementById('ordemPrazo').value;
            
            if (!clienteId || !servicos || !valor) {
                mostrarToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', parseInt(clienteId));
            
            const ordem = {
                clienteId: parseInt(clienteId),
                clienteNome: cliente ? cliente.nome : 'Cliente',
                clienteTelefone: cliente ? cliente.telefone : '',
                servicos,
                valor,
                status,
                dataPrazo: dataPrazo || new Date().toISOString().split('T')[0],
                dataCriacao: new Date().toISOString(),
                numero: 'OS' + Date.now().toString().slice(-6)
            };
            
            if (editingId) ordem.id = editingId;
            
            try {
                if (editingId) {
                    await atualizar('ordens', ordem);
                    mostrarToast('Ordem atualizada!', 'success');
                } else {
                    await adicionar('ordens', ordem);
                    mostrarToast('Ordem criada!', 'success');
                }
                
                fecharModal();
                carregarOrdens();
                carregarDashboard();
                carregarFinanceiro();
                adicionarAtividade(editingId ? 'Ordem atualizada' : 'Nova ordem', cliente?.nome);
                
            } catch (error) {
                mostrarToast('Erro ao salvar ordem', 'error');
            }
        }

        async function carregarOrdens() {
            if (!db) return;
            
            const ordens = await obterTodos('ordens');
            const clientes = await obterTodos('clientes');
            
            const container = document.getElementById('listaOrdens');
            if (!container) return;
            
            if (!ordens || ordens.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Nenhuma ordem</h3>
                        <p>Crie sua primeira ordem</p>
                        <button class="btn btn-primary" onclick="mostrarOrdemForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Criar Ordem
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            ordens.forEach(ordem => {
                const cliente = clientes.find(c => c.id === ordem.clienteId);
                const data = new Date(ordem.dataCriacao).toLocaleDateString('pt-BR');
                
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${ordem.numero}</h3>
                            <p><i class="fas fa-user"></i> ${cliente ? cliente.nome : 'Cliente não encontrado'}</p>
                            <p><i class="fas fa-dollar-sign"></i> R$ ${ordem.valor.toFixed(2)}</p>
                            <span class="status status-${ordem.status}">${ordem.status}</span>
                        </div>
                        <div class="list-item-actions">
                            <button class="icon-btn" onclick="editarOrdem(${ordem.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn pdf" onclick="gerarPDFOrdem(${ordem.id})" title="PDF">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="icon-btn whatsapp" onclick="enviarOrdemWhatsApp(${ordem.id})" title="WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        async function editarOrdem(id) {
            const ordem = await obterPorId('ordens', id);
            if (ordem) mostrarOrdemForm(ordem);
        }

        // ===== AGENDAMENTOS =====
        async function mostrarAgendamentoForm(agendamento = null) {
            editingId = agendamento ? agendamento.id : null;
            
            const clientes = await obterTodos('clientes');
            const clientesOptions = clientes.map(c => 
                `<option value="${c.id}" ${agendamento && agendamento.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
            ).join('');
            
            document.getElementById('modalTitle').textContent = agendamento ? 'Editar Agendamento' : 'Novo Agendamento';
            
            const hoje = new Date().toISOString().split('T')[0];
            const data = agendamento ? agendamento.data : hoje;
            const hora = agendamento ? agendamento.hora : '09:00';
            
            const html = `
                <div class="form-group">
                    <label for="agendamentoCliente">Cliente *</label>
                    <select id="agendamentoCliente" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                        ${clientesOptions}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="agendamentoData">Data *</label>
                    <input type="date" id="agendamentoData" class="form-control" value="${data}" required>
                </div>
                
                <div class="form-group">
                    <label for="agendamentoHora">Hora *</label>
                    <input type="time" id="agendamentoHora" class="form-control" value="${hora}" required>
                </div>
                
                <div class="form-group">
                    <label for="agendamentoServicos">Serviços *</label>
                    <textarea id="agendamentoServicos" class="form-control" placeholder="Descreva os serviços" required rows="3">${agendamento ? agendamento.servicos : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="agendamentoStatus">Status</label>
                    <select id="agendamentoStatus" class="form-control">
                        <option value="agendado" ${agendamento && agendamento.status === 'agendado' ? 'selected' : 'selected'}>Agendado</option>
                        <option value="confirmado" ${agendamento && agendamento.status === 'confirmado' ? 'selected' : ''}>Confirmado</option>
                        <option value="concluido" ${agendamento && agendamento.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                        <option value="cancelado" ${agendamento && agendamento.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                    </select>
                </div>
            `;
            
            const footer = `
                <button type="button" class="btn btn-danger" onclick="fecharModal()">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="salvarAgendamento()">Salvar</button>
                ${agendamento ? `<button type="button" class="btn btn-whatsapp" onclick="enviarLembreteWhatsApp(${agendamento.id})">
                    <i class="fab fa-whatsapp"></i> Lembrete
                </button>` : ''}
            `;
            
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modalFooter').innerHTML = footer;
            
            abrirModal();
        }

        async function salvarAgendamento() {
            const clienteId = document.getElementById('agendamentoCliente').value;
            const data = document.getElementById('agendamentoData').value;
            const hora = document.getElementById('agendamentoHora').value;
            const servicos = document.getElementById('agendamentoServicos').value.trim();
            const status = document.getElementById('agendamentoStatus').value;
            
            if (!clienteId || !data || !hora || !servicos) {
                mostrarToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', parseInt(clienteId));
            
            const agendamento = {
                clienteId: parseInt(clienteId),
                clienteNome: cliente ? cliente.nome : 'Cliente',
                clienteTelefone: cliente ? cliente.telefone : '',
                data,
                hora,
                servicos,
                status,
                dataCriacao: new Date().toISOString()
            };
            
            if (editingId) agendamento.id = editingId;
            
            try {
                if (editingId) {
                    await atualizar('agendamentos', agendamento);
                    mostrarToast('Agendamento atualizado!', 'success');
                } else {
                    await adicionar('agendamentos', agendamento);
                    mostrarToast('Agendamento criado!', 'success');
                }
                
                fecharModal();
                carregarAgendamentos();
                carregarDashboard();
                adicionarAtividade(editingId ? 'Agendamento atualizado' : 'Novo agendamento', cliente?.nome);
                
            } catch (error) {
                mostrarToast('Erro ao salvar agendamento', 'error');
            }
        }

        async function carregarAgendamentos() {
            if (!db) return;
            
            const agendamentos = await obterTodos('agendamentos');
            const clientes = await obterTodos('clientes');
            
            const container = document.getElementById('listaAgendamentos');
            if (!container) return;
            
            if (!agendamentos || agendamentos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Nenhum agendamento</h3>
                        <p>Agende seu primeiro serviço</p>
                        <button class="btn btn-primary" onclick="mostrarAgendamentoForm()" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-plus"></i> Agendar Serviço
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            agendamentos.forEach(agendamento => {
                const cliente = clientes.find(c => c.id === agendamento.clienteId);
                
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${agendamento.data} às ${agendamento.hora}</h3>
                            <p><i class="fas fa-user"></i> ${cliente ? cliente.nome : 'Cliente não encontrado'}</p>
                            <p>${agendamento.servicos.substring(0, 40)}${agendamento.servicos.length > 40 ? '...' : ''}</p>
                            <span class="status status-${agendamento.status}">${agendamento.status}</span>
                        </div>
                        <div class="list-item-actions">
                            <button class="icon-btn" onclick="editarAgendamento(${agendamento.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn whatsapp" onclick="enviarLembreteWhatsApp(${agendamento.id})" title="Lembrete">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        async function editarAgendamento(id) {
            const agendamento = await obterPorId('agendamentos', id);
            if (agendamento) mostrarAgendamentoForm(agendamento);
        }

        // ===== FINANCEIRO =====
        async function carregarFinanceiro() {
            if (!db) return;
            
            const ordens = await obterTodos('ordens');
            
            // Receita do mês
            const mesAtual = new Date().getMonth();
            const anoAtual = new Date().getFullYear();
            
            const receitaMes = ordens
                .filter(o => {
                    const data = new Date(o.dataCriacao);
                    return data.getMonth() === mesAtual && 
                           data.getFullYear() === anoAtual &&
                           o.status === 'concluido';
                })
                .reduce((soma, ordem) => soma + (ordem.valor || 0), 0);
            
            document.getElementById('receitaMes').textContent = 'R$ ' + receitaMes.toFixed(2);
            
            // Pendentes
            const pendentes = ordens
                .filter(o => o.status !== 'concluido' && o.status !== 'cancelado')
                .reduce((soma, ordem) => soma + (ordem.valor || 0), 0);
            
            document.getElementById('pendentes').textContent = 'R$ ' + pendentes.toFixed(2);
            
            // Listar pendentes
            const container = document.getElementById('listaPendentes');
            if (!container) return;
            
            const ordensPendentes = ordens.filter(o => o.status !== 'concluido' && o.status !== 'cancelado');
            
            if (ordensPendentes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Nenhum pendente</h3>
                        <p>Todos os pagamentos em dia!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            ordensPendentes.forEach(ordem => {
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${ordem.numero}</h3>
                            <p>${ordem.clienteNome}</p>
                            <span class="status status-${ordem.status}">${ordem.status}</span>
                        </div>
                        <div style="font-weight: 800; color: var(--danger);">
                            R$ ${ordem.valor.toFixed(2)}
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===== GERAR PDFs =====
        async function gerarPDFOrcamento(id) {
            const orcamento = await obterPorId('orcamentos', id);
            if (!orcamento) {
                mostrarToast('Orçamento não encontrado', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', orcamento.clienteId);
            
            // Criar PDF
            const doc = new jsPDF();
            
            // Configurações
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            const contentWidth = pageWidth - (margin * 2);
            
            // Cabeçalho
            doc.setFillColor(67, 97, 238);
            doc.rect(0, 0, pageWidth, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont('helvetica', 'bold');
            doc.text('CleanSoft Pro', margin, 25);
            
            doc.setFontSize(12);
            doc.text('Lavagem & Seco Premium', margin, 33);
            
            // Título
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('ORÇAMENTO', pageWidth / 2, 60, { align: 'center' });
            
            // Número do orçamento
            doc.setFontSize(14);
            doc.text(`Nº: ${orcamento.numero}`, pageWidth - margin, 60, { align: 'right' });
            
            // Linha separadora
            doc.setDrawColor(67, 97, 238);
            doc.setLineWidth(0.5);
            doc.line(margin, 65, pageWidth - margin, 65);
            
            let yPos = 80;
            
            // Informações do cliente
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('CLIENTE:', margin, yPos);
            
            doc.setFont('helvetica', 'normal');
            doc.text(cliente ? cliente.nome : 'Cliente não encontrado', margin + 25, yPos);
            
            yPos += 10;
            doc.text('Telefone:', margin, yPos);
            doc.text(cliente ? cliente.telefone : 'Não informado', margin + 25, yPos);
            
            if (cliente && cliente.email) {
                yPos += 10;
                doc.text('E-mail:', margin, yPos);
                doc.text(cliente.email, margin + 25, yPos);
            }
            
            if (cliente && cliente.endereco) {
                yPos += 10;
                doc.text('Endereço:', margin, yPos);
                doc.text(cliente.endereco, margin + 25, yPos);
            }
            
            yPos += 20;
            
            // Informações do orçamento
            const data = new Date(orcamento.data).toLocaleDateString('pt-BR');
            const validadeData = new Date(orcamento.data);
            validadeData.setDate(validadeData.getDate() + orcamento.validade);
            const validadeStr = validadeData.toLocaleDateString('pt-BR');
            
            doc.setFont('helvetica', 'bold');
            doc.text('DATA DO ORÇAMENTO:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(data, margin + 55, yPos);
            
            yPos += 10;
            doc.setFont('helvetica', 'bold');
            doc.text('VALIDADE:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(validadeStr, margin + 30, yPos);
            
            yPos += 20;
            
            // Serviços
            doc.setFont('helvetica', 'bold');
            doc.text('SERVIÇOS SOLICITADOS:', margin, yPos);
            yPos += 10;
            
            doc.setFont('helvetica', 'normal');
            const servicosLines = doc.splitTextToSize(orcamento.servicos, contentWidth);
            doc.text(servicosLines, margin, yPos);
            yPos += (servicosLines.length * 7);
            
            yPos += 10;
            
            // Valor
            doc.setFont('helvetica', 'bold');
            doc.text('VALOR TOTAL:', margin, yPos);
            doc.setFontSize(16);
            doc.text(`R$ ${orcamento.valor.toFixed(2)}`, pageWidth - margin, yPos, { align: 'right' });
            
            yPos += 20;
            
            // Status
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('STATUS:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(orcamento.status.toUpperCase(), margin + 25, yPos);
            
            // Rodapé
            yPos += 30;
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('Este orçamento é válido até a data de validade informada.', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 10;
            doc.text('CleanSoft Pro - Sistema de Gestão de Lavanderia', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 10;
            doc.text(`Documento gerado em: ${new Date().toLocaleDateString('pt-BR')}`, pageWidth / 2, yPos, { align: 'center' });
            
            // Salvar PDF
            doc.save(`Orcamento_${orcamento.numero}.pdf`);
            
            adicionarAtividade('PDF gerado - Orçamento', orcamento.numero);
            mostrarToast('PDF gerado com sucesso!', 'success');
        }

        async function gerarPDFOrdem(id) {
            const ordem = await obterPorId('ordens', id);
            if (!ordem) {
                mostrarToast('Ordem não encontrada', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', ordem.clienteId);
            
            // Criar PDF
            const doc = new jsPDF();
            
            // Configurações
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            const contentWidth = pageWidth - (margin * 2);
            
            // Cabeçalho
            doc.setFillColor(67, 97, 238);
            doc.rect(0, 0, pageWidth, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont('helvetica', 'bold');
            doc.text('CleanSoft Pro', margin, 25);
            
            doc.setFontSize(12);
            doc.text('Lavagem & Seco Premium', margin, 33);
            
            // Título
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('ORDEM DE SERVIÇO', pageWidth / 2, 60, { align: 'center' });
            
            // Número da ordem
            doc.setFontSize(14);
            doc.text(`Nº: ${ordem.numero}`, pageWidth - margin, 60, { align: 'right' });
            
            // Linha separadora
            doc.setDrawColor(67, 97, 238);
            doc.setLineWidth(0.5);
            doc.line(margin, 65, pageWidth - margin, 65);
            
            let yPos = 80;
            
            // Informações do cliente
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('CLIENTE:', margin, yPos);
            
            doc.setFont('helvetica', 'normal');
            doc.text(cliente ? cliente.nome : 'Cliente não encontrado', margin + 25, yPos);
            
            yPos += 10;
            doc.text('Telefone:', margin, yPos);
            doc.text(cliente ? cliente.telefone : 'Não informado', margin + 25, yPos);
            
            if (cliente && cliente.email) {
                yPos += 10;
                doc.text('E-mail:', margin, yPos);
                doc.text(cliente.email, margin + 25, yPos);
            }
            
            yPos += 20;
            
            // Informações da ordem
            const dataCriacao = new Date(ordem.dataCriacao).toLocaleDateString('pt-BR');
            
            doc.setFont('helvetica', 'bold');
            doc.text('DATA DA ORDEM:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(dataCriacao, margin + 45, yPos);
            
            yPos += 10;
            doc.setFont('helvetica', 'bold');
            doc.text('PRAZO:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(ordem.dataPrazo, margin + 25, yPos);
            
            yPos += 20;
            
            // Serviços
            doc.setFont('helvetica', 'bold');
            doc.text('SERVIÇOS A REALIZAR:', margin, yPos);
            yPos += 10;
            
            doc.setFont('helvetica', 'normal');
            const servicosLines = doc.splitTextToSize(ordem.servicos, contentWidth);
            doc.text(servicosLines, margin, yPos);
            yPos += (servicosLines.length * 7);
            
            yPos += 10;
            
            // Valor
            doc.setFont('helvetica', 'bold');
            doc.text('VALOR DO SERVIÇO:', margin, yPos);
            doc.setFontSize(16);
            doc.text(`R$ ${ordem.valor.toFixed(2)}`, pageWidth - margin, yPos, { align: 'right' });
            
            yPos += 20;
            
            // Status
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('STATUS:', margin, yPos);
            doc.setFont('helvetica', 'normal');
            doc.text(ordem.status.toUpperCase(), margin + 25, yPos);
            
            yPos += 10;
            
            // Observações
            doc.setFont('helvetica', 'bold');
            doc.text('OBSERVAÇÕES:', margin, yPos);
            yPos += 10;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text('1. Esta ordem deve ser apresentada no momento da retirada dos serviços.', margin, yPos);
            yPos += 7;
            doc.text('2. O prazo informado é estimado e pode sofrer alterações conforme demanda.', margin, yPos);
            yPos += 7;
            doc.text('3. Em caso de cancelamento, entrar em contato com 24h de antecedência.', margin, yPos);
            
            // Rodapé
            yPos += 30;
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('CleanSoft Pro - Sistema de Gestão de Lavanderia', pageWidth / 2, yPos, { align: 'center' });
            
            yPos += 10;
            doc.text(`Documento gerado em: ${new Date().toLocaleDateString('pt-BR')}`, pageWidth / 2, yPos, { align: 'center' });
            
            // Salvar PDF
            doc.save(`Ordem_Servico_${ordem.numero}.pdf`);
            
            adicionarAtividade('PDF gerado - Ordem', ordem.numero);
            mostrarToast('PDF gerado com sucesso!', 'success');
        }

        // ===== WHATSAPP INTEGRATION =====
        async function enviarWhatsApp(telefone, tipo) {
            if (!whatsappNumero) {
                mostrarToast('Configure seu número do WhatsApp primeiro', 'warning');
                mostrarPagina('configuracoes');
                return;
            }
            
            const numeroFormatado = telefone.replace(/\D/g, '');
            const mensagem = encodeURIComponent(`Olá! Gostaria de falar sobre seus serviços.`);
            const url = `https://wa.me/${numeroFormatado}?text=${mensagem}`;
            
            window.open(url, '_blank');
        }

        async function enviarOrcamentoWhatsApp(orcamentoId) {
            const orcamento = await obterPorId('orcamentos', orcamentoId);
            if (!orcamento) {
                mostrarToast('Orçamento não encontrado', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', orcamento.clienteId);
            if (!cliente || !cliente.telefone) {
                mostrarToast('Cliente sem telefone cadastrado', 'error');
                return;
            }
            
            const numeroFormatado = cliente.telefone.replace(/\D/g, '');
            const data = new Date(orcamento.data).toLocaleDateString('pt-BR');
            const validadeData = new Date(orcamento.data);
            validadeData.setDate(validadeData.getDate() + orcamento.validade);
            const validadeStr = validadeData.toLocaleDateString('pt-BR');
            
            let mensagem = `*CleanSoft Pro - Orçamento #${orcamento.numero}*\n\n`;
            mensagem += `*Cliente:* ${cliente.nome}\n`;
            mensagem += `*Data:* ${data}\n`;
            mensagem += `*Validade:* ${validadeStr}\n\n`;
            mensagem += `*SERVIÇOS:*\n${orcamento.servicos}\n\n`;
            mensagem += `*VALOR TOTAL:* R$ ${orcamento.valor.toFixed(2)}\n\n`;
            mensagem += `*STATUS:* ${orcamento.status}\n\n`;
            mensagem += `_Este orçamento é válido até ${validadeStr}_\n\n`;
            mensagem += `Para aprovar este orçamento, responda esta mensagem com "APROVADO"`;
            
            const url = `https://wa.me/${numeroFormatado}?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
            
            adicionarAtividade('Orçamento enviado por WhatsApp', cliente.nome);
            mostrarToast('Orçamento enviado para WhatsApp!', 'success');
        }

        async function enviarOrdemWhatsApp(ordemId) {
            const ordem = await obterPorId('ordens', ordemId);
            if (!ordem) {
                mostrarToast('Ordem não encontrada', 'error');
                return;
            }
            
            const cliente = await obterPorId('clientes', ordem.clienteId);
            if (!cliente || !cliente.telefone) {
                mostrarToast('Cliente sem telefone cadastrado', 'error');
                return;
            }
            
            const numeroFormatado = cliente.telefone.replace(/\D/g, '');
            const data = new Date(ordem.dataCriacao).toLocaleDateString('pt-BR');
            
            let mensagem = `*CleanSoft Pro - Ordem de Serviço ${ordem.numero}*\n\n`;
            mensagem += `*Cliente:* ${cliente.nome}\n`;
            mensagem += `*Data:* ${data}\n`;
            mensagem += `*Prazo:* ${ordem.dataPrazo}\n\n`;
            mensagem += `*SERVIÇOS:*\n${ordem.servicos}\n\n`;
            mensagem += `*VALOR:* R$ ${ordem.valor.toFixed(2)}\n\n`;
            mensagem += `*STATUS:* ${ordem.status}\n\n`;
            mensagem += `Acompanhe o status do seu serviço através deste número.`;
            
            const url = `https://wa.me/${numeroFormatado}?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
            
            adicionarAtividade('Ordem enviada por WhatsApp', cliente.nome);
            mostrarToast('Ordem enviada para WhatsApp!', 'success');
        }

        async function enviarLembreteWhatsApp(agendamentoId) {
            const agendamento = await obterPorId('agendamentos', agendamentoId);
            if (!agendamento) {
                mostrarToast('Agendamento não encontrado', 'error');
                return;
            }
            
            if (!agendamento.clienteTelefone) {
                const cliente = await obterPorId('clientes', agendamento.clienteId);
                if (!cliente || !cliente.telefone) {
                    mostrarToast('Cliente sem telefone cadastrado', 'error');
                    return;
                }
                agendamento.clienteTelefone = cliente.telefone;
            }
            
            const numeroFormatado = agendamento.clienteTelefone.replace(/\D/g, '');
            
            let mensagem = `*CleanSoft Pro - Lembrete de Agendamento*\n\n`;
            mensagem += `Olá ${agendamento.clienteNome},\n\n`;
            mensagem += `Este é um lembrete do seu agendamento:\n\n`;
            mensagem += `*Data:* ${agendamento.data}\n`;
            mensagem += `*Hora:* ${agendamento.hora}\n\n`;
            mensagem += `*Serviços:*\n${agendamento.servicos}\n\n`;
            mensagem += `*Status:* ${agendamento.status}\n\n`;
            mensagem += `Por favor, confirme sua presença respondendo esta mensagem.\n`;
            mensagem += `Para reagendar ou cancelar, entre em contato.`;
            
            const url = `https://wa.me/${numeroFormatado}?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
            
            adicionarAtividade('Lembrete enviado por WhatsApp', agendamento.clienteNome);
            mostrarToast('Lembrete enviado!', 'success');
        }

        // ===== BACKUP E RESTAURAÇÃO =====
        async function exportarDados() {
            if (!db) {
                mostrarToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            try {
                const dados = {
                    clientes: await obterTodos('clientes'),
                    orcamentos: await obterTodos('orcamentos'),
                    ordens: await obterTodos('ordens'),
                    agendamentos: await obterTodos('agendamentos'),
                    atividades: await obterTodos('atividades'),
                    config: await obterTodos('config'),
                    dataExportacao: new Date().toISOString(),
                    versao: '2.0',
                    sistema: 'CleanSoft Pro'
                };
                
                const dadosStr = JSON.stringify(dados, null, 2);
                const blob = new Blob([dadosStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `cleansoft_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                mostrarToast('Backup exportado com sucesso!', 'success');
                adicionarAtividade('Backup exportado');
                
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                mostrarToast('Erro ao exportar dados', 'error');
            }
        }

        function mostrarImportarBackup() {
            const container = document.getElementById('importContainer');
            container.style.display = 'block';
            
            const fileInput = document.getElementById('backupFile');
            fileInput.onchange = function(e) {
                importarDados(e.target.files[0]);
            };
            
            mostrarToast('Selecione o arquivo de backup (.json)', 'warning');
        }

        async function importarDados(arquivo) {
            if (!arquivo) {
                mostrarToast('Nenhum arquivo selecionado', 'error');
                return;
            }
            
            if (!confirm('ATENÇÃO: Importar dados substituirá os dados atuais. Deseja continuar?')) {
                return;
            }
            
            const leitor = new FileReader();
            
            leitor.onload = async function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    // Validar estrutura do backup
                    if (!dados.versao || !dados.sistema) {
                        mostrarToast('Arquivo de backup inválido', 'error');
                        return;
                    }
                    
                    mostrarToast('Importando dados...', 'warning');
                    
                    // Limpar dados atuais
                    const stores = ['clientes', 'orcamentos', 'ordens', 'agendamentos', 'atividades', 'config'];
                    
                    for (const storeName of stores) {
                        const transaction = db.transaction([storeName], 'readwrite');
                        const store = transaction.objectStore(storeName);
                        await new Promise(resolve => {
                            const request = store.clear();
                            request.onsuccess = () => resolve();
                            request.onerror = () => resolve();
                        });
                    }
                    
                    // Importar novos dados
                    if (dados.clientes && Array.isArray(dados.clientes)) {
                        for (const cliente of dados.clientes) {
                            await adicionar('clientes', cliente);
                        }
                    }
                    
                    if (dados.orcamentos && Array.isArray(dados.orcamentos)) {
                        for (const orcamento of dados.orcamentos) {
                            await adicionar('orcamentos', orcamento);
                        }
                    }
                    
                    if (dados.ordens && Array.isArray(dados.ordens)) {
                        for (const ordem of dados.ordens) {
                            await adicionar('ordens', ordem);
                        }
                    }
                    
                    if (dados.agendamentos && Array.isArray(dados.agendamentos)) {
                        for (const agendamento of dados.agendamentos) {
                            await adicionar('agendamentos', agendamento);
                        }
                    }
                    
                    if (dados.atividades && Array.isArray(dados.atividades)) {
                        for (const atividade of dados.atividades) {
                            await adicionar('atividades', atividade);
                        }
                    }
                    
                    if (dados.config && Array.isArray(dados.config)) {
                        for (const config of dados.config) {
                            await adicionar('config', config);
                        }
                    }
                    
                    // Resetar input de arquivo
                    document.getElementById('backupFile').value = '';
                    document.getElementById('importContainer').style.display = 'none';
                    
                    // Recarregar dados
                    carregarDados();
                    carregarConfiguracoes();
                    
                    mostrarToast('Dados importados com sucesso!', 'success');
                    adicionarAtividade('Backup importado');
                    
                } catch (error) {
                    console.error('Erro ao importar dados:', error);
                    mostrarToast('Erro ao importar dados. Arquivo inválido.', 'error');
                }
            };
            
            leitor.onerror = function() {
                mostrarToast('Erro ao ler arquivo', 'error');
            };
            
            leitor.readAsText(arquivo);
        }

        // ===== ATIVIDADES =====
        async function carregarAtividades() {
            if (!db) return;
            
            const atividades = await obterTodos('atividades');
            const container = document.getElementById('recentActivities');
            if (!container) return;
            
            if (!atividades || atividades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>Nenhuma atividade</h3>
                        <p>As atividades aparecerão aqui</p>
                    </div>
                `;
                return;
            }
            
            const ultimasAtividades = atividades.slice(-5).reverse();
            let html = '';
            
            ultimasAtividades.forEach(atividade => {
                const data = new Date(atividade.data).toLocaleDateString('pt-BR');
                const hora = new Date(atividade.data).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <li class="list-item">
                        <div class="list-item-content">
                            <h3>${atividade.descricao}</h3>
                            <p>${atividade.detalhes ? atividade.detalhes + ' • ' : ''}${data} ${hora}</p>
                        </div>
                    </li>
                `;
            });
            
            container.innerHTML = html;
        }

        async function adicionarAtividade(descricao, detalhes = '') {
            if (!db) return;
            
            const atividade = {
                descricao,
                detalhes,
                data: new Date().toISOString()
            };
            
            try {
                await adicionar('atividades', atividade);
                carregarAtividades();
            } catch (error) {
                console.error('Erro ao adicionar atividade:', error);
            }
        }

        // ===== CONFIGURAÇÕES =====
        async function carregarConfiguracoes() {
            if (!db) return;
            
            try {
                const config = await obterPorId('config', 'app');
                if (config) {
                    whatsappNumero = config.whatsappNumero || '';
                    document.getElementById('whatsappNumero').value = whatsappNumero;
                    document.getElementById('empresaNome').value = config.empresaNome || '';
                    document.getElementById('empresaTelefone').value = config.empresaTelefone || '';
                }
            } catch (error) {
                console.error('Erro ao carregar configurações:', error);
            }
        }

        async function salvarConfiguracoes() {
            const empresaNome = document.getElementById('empresaNome').value.trim();
            const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
            whatsappNumero = document.getElementById('whatsappNumero').value.trim();
            
            if (!whatsappNumero) {
                mostrarToast('Informe o número do WhatsApp para envios', 'warning');
                return;
            }
            
            const config = {
                id: 'app',
                empresaNome,
                empresaTelefone,
                whatsappNumero,
                dataAtualizacao: new Date().toISOString()
            };
            
            try {
                await atualizar('config', config);
                mostrarToast('Configurações salvas!', 'success');
                adicionarAtividade('Configurações atualizadas');
            } catch (error) {
                mostrarToast('Erro ao salvar configurações', 'error');
            }
        }

        async function limparDados() {
            if (!confirm('ATENÇÃO: Tem certeza que deseja limpar TODOS os dados? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            if (!db) return;
            
            try {
                const stores = ['clientes', 'orcamentos', 'ordens', 'agendamentos', 'atividades'];
                
                for (const storeName of stores) {
                    const transaction = db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    await new Promise(resolve => {
                        const request = store.clear();
                        request.onsuccess = () => resolve();
                        request.onerror = () => resolve();
                    });
                }
                
                mostrarToast('Todos os dados foram limpos!', 'success');
                carregarDados();
                adicionarAtividade('Dados limpos');
                
            } catch (error) {
                mostrarToast('Erro ao limpar dados', 'error');
            }
        }

        // ===== FUNÇÕES UTILITÁRIAS DO BANCO =====
        function obterTodos(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve([]);
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => resolve([]);
            });
        }

        function obterPorId(storeName, id) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    resolve(null);
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(id);
                
                request.onsuccess = () => resolve(request.result || null);
                request.onerror = () => resolve(null);
            });
        }

        function adicionar(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('Banco de dados não inicializado');
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.add(data);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        function atualizar(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('Banco de dados não inicializado');
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // ===== MODAL FUNCTIONS =====
        function abrirModal() {
            document.getElementById('modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function fecharModal() {
            document.getElementById('modal').classList.remove('active');
            editingId = null;
            document.getElementById('modalBody').innerHTML = '';
            document.getElementById('modalFooter').innerHTML = '';
            document.body.style.overflow = '';
        }

        // ===== TOAST NOTIFICATIONS =====
        function mostrarToast(mensagem, tipo = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;
            toast.textContent = mensagem;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // ===== DADOS DEMONSTRAÇÃO =====
        setTimeout(() => {
            // Adicionar dados de demonstração se estiver vazio
            const checkAndAddDemoData = async () => {
                const clientes = await obterTodos('clientes');
                if (clientes.length === 0) {
                    const demoClientes = [
                        { nome: 'Maria Silva', telefone: '(11) 99999-1111', email: 'maria@email.com', endereco: 'Rua das Flores, 123', dataCadastro: new Date().toISOString(), status: 'ativo' },
                        { nome: 'João Santos', telefone: '(11) 99999-2222', email: 'joao@email.com', endereco: 'Av. Paulista, 1000', dataCadastro: new Date().toISOString(), status: 'ativo' },
                        { nome: 'Ana Oliveira', telefone: '(11) 99999-3333', email: 'ana@email.com', endereco: 'Rua Augusta, 500', dataCadastro: new Date().toISOString(), status: 'ativo' }
                    ];
                    
                    for (const cliente of demoClientes) {
                        await adicionar('clientes', cliente);
                    }
                    
                    carregarDados();
                    mostrarToast('Dados de demonstração carregados!', 'success');
                }
            };
            
            checkAndAddDemoData();
        }, 2000);
    </script>
</body>
</html>
