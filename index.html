<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4361ee">
    <title>CleanSoft Mobile Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.css">
    <style>
        /* ===== VARIÁVEIS DE DESIGN ATUALIZADAS ===== */
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --success-dark: #3a86ff;
            --warning: #f8961e;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --card-bg: #ffffff;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 15px 50px rgba(0, 0, 0, 0.12);
            --radius: 20px;
            --radius-sm: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, #4361ee, #3a0ca3);
            --gradient-success: linear-gradient(135deg, #4cc9f0, #4895ef);
            --gradient-warning: linear-gradient(135deg, #f8961e, #f3722c);
            --gradient-danger: linear-gradient(135deg, #f72585, #b5179e);
            --gradient-secondary: linear-gradient(135deg, #7209b7, #560bad);
            --gradient-chart-1: linear-gradient(135deg, #4361ee, #3a86ff);
            --gradient-chart-2: linear-gradient(135deg, #f72585, #ff006e);
            --gradient-chart-3: linear-gradient(135deg, #4cc9f0, #3a86ff);
            --gradient-chart-4: linear-gradient(135deg, #f8961e, #fb5607);
        }

        /* ===== RESET & BASE OTIMIZADOS ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            line-height: 1.5;
            min-height: 100vh;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* ===== APP HEADER MODERNO PREMIUM ===== */
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px 25px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(67, 97, 238, 0.3);
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 800;
            line-height: 1.2;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.85rem;
            opacity: 0.95;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .date-time {
            text-align: right;
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .date-time .date {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .date-time .time {
            font-size: 1.4rem;
            font-weight: 800;
            letter-spacing: 1.5px;
        }

        .page-title {
            font-size: 1.4rem;
            font-weight: 700;
            padding: 12px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ===== BOTTOM NAVIGATION PREMIUM ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(25px);
            display: flex;
            justify-content: space-around;
            padding: 15px 10px;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.5);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            transition: var(--transition);
            flex: 1;
            max-width: 85px;
            position: relative;
        }

        .nav-icon {
            width: 50px;
            height: 50px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
            background: var(--light-gray);
            margin-bottom: 8px;
            border: 2px solid transparent;
        }

        .nav-item span {
            font-size: 0.8rem;
            font-weight: 700;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active .nav-icon {
            background: var(--gradient-primary);
            color: white;
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(67, 97, 238, 0.5);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .nav-indicator {
            position: absolute;
            top: -10px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            opacity: 0;
            transform: scale(0);
            transition: var(--transition);
        }

        .nav-item.active .nav-indicator {
            opacity: 1;
            transform: scale(1);
        }

        /* ===== MAIN CONTENT OTIMIZADO ===== */
        .main-content {
            padding: 25px;
            max-width: 520px;
            margin: 0 auto;
            animation: fadeInUp 0.5s ease;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ===== STATS CARDS PREMIUM ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary);
            opacity: 0;
            transition: var(--transition);
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .stat-card:nth-child(1)::before { background: var(--primary); }
        .stat-card:nth-child(2)::before { background: var(--secondary); }
        .stat-card:nth-child(3)::before { background: var(--warning); }
        .stat-card:nth-child(4)::before { background: var(--danger); }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(67, 97, 238, 0.2);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:active {
            animation: pulse 0.3s ease;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 18px;
            font-size: 1.6rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-card:nth-child(1) .stat-icon { background: var(--gradient-primary); }
        .stat-card:nth-child(2) .stat-icon { background: var(--gradient-success); }
        .stat-card:nth-child(3) .stat-icon { background: var(--gradient-warning); }
        .stat-card:nth-child(4) .stat-icon { background: var(--gradient-danger); }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--dark), var(--gray));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-info p {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-trend {
            font-size: 0.8rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend-up { color: #4cc9f0; }
        .trend-down { color: #f72585; }

        /* ===== QUICK ACTIONS PREMIUM ===== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 35px;
        }

        .action-btn {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 28px 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--dark);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid transparent;
            width: 100%;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(58, 12, 163, 0.05) 100%);
            opacity: 0;
            transition: var(--transition);
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(67, 97, 238, 0.2);
        }

        .action-btn:hover::before {
            opacity: 1;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .action-btn i {
            font-size: 2.4rem;
            margin-bottom: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: var(--transition);
        }

        .action-btn:hover i {
            transform: scale(1.15);
        }

        .action-btn span {
            font-weight: 700;
            text-align: center;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        /* ===== CARDS MODERNAS PREMIUM ===== */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 28px;
            margin-bottom: 28px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-3px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--light-gray);
        }

        .card-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .card-header h2 i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== BOTÕES PREMIUM ===== */
        .btn {
            padding: 16px 28px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.15);
            opacity: 0;
            transition: var(--transition);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 14px;
            background: var(--light-gray);
            color: var(--dark);
        }

        .btn-icon:hover {
            background: var(--primary);
            color: white;
        }

        /* ===== LISTS PREMIUM ===== */
        .list {
            list-style: none;
        }

        .list-item {
            padding: 22px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .list-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: var(--primary);
            opacity: 0;
            transition: var(--transition);
        }

        .list-item:hover {
            background: linear-gradient(90deg, #f8f9ff 0%, #ffffff 100%);
            transform: translateX(8px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .list-item:hover::before {
            opacity: 1;
        }

        .list-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .list-item-content h3 {
            font-size: 1.05rem;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--dark);
        }

        .list-item-content p {
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light-gray);
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            position: relative;
            overflow: hidden;
        }

        .icon-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            opacity: 0;
            transition: var(--transition);
        }

        .icon-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .icon-btn:hover::before {
            opacity: 1;
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn.edit { color: var(--primary); background: rgba(67, 97, 238, 0.1); }
        .icon-btn.edit:hover { background: var(--primary); color: white; }
        .icon-btn.delete { color: var(--danger); background: rgba(247, 37, 133, 0.1); }
        .icon-btn.delete:hover { background: var(--danger); color: white; }
        .icon-btn.view { color: var(--success); background: rgba(76, 201, 240, 0.1); }
        .icon-btn.view:hover { background: var(--success); color: white; }
        .icon-btn.whatsapp { color: #25D366; background: rgba(37, 211, 102, 0.1); }
        .icon-btn.whatsapp:hover { background: #25D366; color: white; }

        /* ===== STATUS BADGES PREMIUM ===== */
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid transparent;
        }

        .status-pendente {
            background: rgba(248, 150, 30, 0.15);
            color: #f8961e;
            border-color: rgba(248, 150, 30, 0.3);
        }

        .status-aprovado {
            background: rgba(76, 201, 240, 0.15);
            color: #4cc9f0;
            border-color: rgba(76, 201, 240, 0.3);
        }

        .status-concluido {
            background: rgba(67, 97, 238, 0.15);
            color: #4361ee;
            border-color: rgba(67, 97, 238, 0.3);
        }

        .status-cancelado {
            background: rgba(247, 37, 133, 0.15);
            color: #f72585;
            border-color: rgba(247, 37, 133, 0.3);
        }

        .status-andamento {
            background: rgba(114, 9, 183, 0.15);
            color: #7209b7;
            border-color: rgba(114, 9, 183, 0.3);
        }

        .status-agendado {
            background: rgba(72, 149, 239, 0.15);
            color: #4895ef;
            border-color: rgba(72, 149, 239, 0.3);
        }

        .status-enviado {
            background: rgba(58, 12, 163, 0.15);
            color: #3a0ca3;
            border-color: rgba(58, 12, 163, 0.3);
        }

        /* ===== FORMS PREMIUM ===== */
        .form-group {
            margin-bottom: 28px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--dark);
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .form-control {
            width: 100%;
            padding: 18px 22px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
        }

        textarea.form-control {
            min-height: 140px;
            resize: vertical;
            line-height: 1.5;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 18px;
            padding-right: 52px;
        }

        .form-required::after {
            content: '*';
            color: var(--danger);
            margin-left: 4px;
        }

        /* ===== MODAL PREMIUM ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(60px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 28px 28px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 1;
        }

        .modal-header h2 {
            font-size: 1.6rem;
            color: var(--dark);
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-modal {
            background: var(--light-gray);
            border: none;
            font-size: 1.8rem;
            color: var(--gray);
            cursor: pointer;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 28px;
        }

        .modal-footer {
            padding: 28px;
            border-top: 3px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            position: sticky;
            bottom: 0;
            background: var(--card-bg);
        }

        /* ===== CHART CONTAINERS ===== */
        .chart-container {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ===== FINANCIAL CARDS ===== */
        .financial-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .financial-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .financial-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary);
            opacity: 0.8;
        }

        .financial-card:nth-child(2)::before { background: var(--success); }
        .financial-card:nth-child(3)::before { background: var(--warning); }
        .financial-card:nth-child(4)::before { background: var(--danger); }

        .financial-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .financial-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }

        .financial-card:nth-child(1) i { color: var(--primary); }
        .financial-card:nth-child(2) i { color: var(--success); }
        .financial-card:nth-child(3) i { color: var(--warning); }
        .financial-card:nth-child(4) i { color: var(--danger); }

        .financial-card h3 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--dark), var(--gray));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .financial-card p {
            color: var(--gray);
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        /* ===== EMPTY STATE PREMIUM ===== */
        .empty-state {
            text-align: center;
            padding: 80px 25px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 5rem;
            margin-bottom: 25px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark);
            font-weight: 700;
        }

        .empty-state p {
            font-size: 1rem;
            margin-bottom: 30px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ===== FLOATING ACTION BUTTON PREMIUM ===== */
        .fab {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 22px;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.6);
            border: none;
            cursor: pointer;
            z-index: 999;
            transition: var(--transition);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .fab:hover {
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 20px 45px rgba(67, 97, 238, 0.7);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* ===== SEARCH & FILTERS PREMIUM ===== */
        .search-box {
            position: relative;
            margin-bottom: 25px;
        }

        .search-input {
            width: 100%;
            padding: 20px 28px 20px 60px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            font-size: 1rem;
            background: white;
            transition: var(--transition);
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
        }

        .search-icon {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.3rem;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-select {
            flex: 1;
            min-width: 150px;
            padding: 16px 18px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-sm);
            background: white;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .filter-select:focus {
            border-color: var(--primary);
            outline: none;
        }

        /* ===== SETTINGS PAGE PREMIUM ===== */
        .settings-section {
            margin-bottom: 40px;
        }

        .settings-section h3 {
            color: var(--dark);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--light-gray);
            font-size: 1.3rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-section h3 i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-preview {
            width: 140px;
            height: 140px;
            border-radius: var(--radius);
            object-fit: cover;
            border: 3px dashed var(--light-gray);
            padding: 12px;
            display: block;
            margin: 0 auto 25px;
            transition: var(--transition);
            cursor: pointer;
        }

        .logo-preview:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: block;
            margin-bottom: 25px;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .backup-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 28px;
        }

        .backup-option {
            background: white;
            border-radius: var(--radius);
            padding: 35px 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .backup-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary);
            opacity: 0;
            transition: var(--transition);
        }

        .backup-option:hover {
            border-color: var(--primary);
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .backup-option:hover::before {
            opacity: 1;
        }

        .backup-option i {
            font-size: 3.5rem;
            margin-bottom: 25px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .backup-option h4 {
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 800;
        }

        .backup-option p {
            font-size: 0.9rem;
            color: var(--gray);
            line-height: 1.5;
        }

        /* ===== TOAST NOTIFICATIONS PREMIUM ===== */
        .toast-notification {
            position: fixed;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 20px 32px;
            border-radius: var(--radius);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            font-weight: 700;
            max-width: 90%;
            text-align: center;
            animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toast-notification.success {
            background: var(--gradient-success);
        }

        .toast-notification.error {
            background: var(--gradient-danger);
        }

        .toast-notification.warning {
            background: var(--gradient-warning);
        }

        .toast-notification.info {
            background: var(--gradient-primary);
        }

        @keyframes slideDown {
            from { top: 100px; opacity: 0; }
            to { top: 130px; opacity: 1; }
        }

        /* ===== RESPONSIVE DESIGN PREMIUM ===== */
        @media (max-width: 380px) {
            .stats-grid,
            .quick-actions,
            .financial-grid,
            .backup-options {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 18px;
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .modal-body,
            .modal-footer {
                padding: 22px;
            }
            
            .app-header {
                padding: 20px;
            }
            
            .logo-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .nav-icon {
                width: 44px;
                height: 44px;
            }
        }

        /* ===== ANIMAÇÕES ADICIONAIS ===== */
        .pulse {
            animation: pulse 2s infinite;
        }

        .float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* ===== SCROLLBAR PERSONALIZADA ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ===== LOADING SPINNER ===== */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(67, 97, 238, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <header class="app-header">
        <div class="header-top">
            <div class="logo-container">
                <div id="logoPreview" class="logo-icon">
                    <i class="fas fa-spray-can-sparkles"></i>
                </div>
                <div class="logo-text">
                    <h1 id="empresaNome">Clean<span style="color: #4cc9f0">Soft</span> Pro</h1>
                    <p id="empresaSlogan">Excelência em Lavagem & Seco</p>
                </div>
            </div>
            <div class="date-time">
                <div id="currentDate" class="date">--/--/----</div>
                <div id="currentTime" class="time">--:--</div>
            </div>
        </div>
        <div class="page-title">
            <i class="fas fa-home"></i>
            <span id="pageTitle">Dashboard Premium</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard -->
        <section id="dashboard" class="page active">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card" onclick="showPage('clientes')">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalClientes">0</h3>
                        <p>Clientes Ativos</p>
                        <div class="stat-trend trend-up" id="clientesTrend">
                            <i class="fas fa-arrow-up"></i> <span>0%</span>
                        </div>
                    </div>
                </div>
                <div class="stat-card" onclick="showPage('financeiro')">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="receitaTotal">R$ 0</h3>
                        <p>Receita Total</p>
                        <div class="stat-trend trend-up" id="receitaTrend">
                            <i class="fas fa-arrow-up"></i> <span>0%</span>
                        </div>
                    </div>
                </div>
                <div class="stat-card" onclick="showPage('ordens')">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalOrdens">0</h3>
                        <p>Ordens Ativas</p>
                        <div class="stat-trend trend-down" id="ordensTrend">
                            <i class="fas fa-arrow-down"></i> <span>0%</span>
                        </div>
                    </div>
                </div>
                <div class="stat-card" onclick="showPage('agendamentos')">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalAgendamentos">0</h3>
                        <p>Agendamentos Hoje</p>
                        <div class="stat-trend" id="agendamentosTrend">
                            <i class="fas fa-minus"></i> <span>0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-bolt"></i> Ações Rápidas</h2>
                    <button class="btn btn-icon" onclick="loadRecentActivities()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="showClienteForm()">
                        <i class="fas fa-user-plus"></i>
                        <span>Novo Cliente</span>
                    </button>
                    <button class="action-btn" onclick="showOrcamentoForm()">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Novo Orçamento</span>
                    </button>
                    <button class="action-btn" onclick="showOrdemForm()">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Nova Ordem</span>
                    </button>
                    <button class="action-btn" onclick="showFinanceModal()">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Registrar Pagamento</span>
                    </button>
                </div>
            </div>

            <!-- Gráfico de Receitas -->
            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-chart-bar"></i>
                    <span>Receitas do Mês</span>
                </div>
                <div id="revenueChart"></div>
            </div>

            <!-- Recent Activities -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Atividades Recentes</h2>
                    <button class="btn btn-icon" onclick="loadRecentActivities()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <ul class="list" id="recentActivities">
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>Carregando atividades...</h3>
                        <p>As atividades recentes aparecerão aqui</p>
                        <div class="spinner"></div>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Clientes -->
        <section id="clientes" class="page">
            <div class="search-box">
                <input type="text" id="searchCliente" class="search-input" placeholder="Buscar clientes...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-users"></i> Clientes</h2>
                    <button class="btn btn-primary" onclick="showClienteForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaClientes">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>Nenhum cliente encontrado</h3>
                        <p>Adicione seu primeiro cliente</p>
                        <button class="btn btn-primary" onclick="showClienteForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Adicionar Cliente
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Orçamentos -->
        <section id="orcamentos" class="page">
            <div class="filter-bar">
                <select id="filterStatusOrcamento" class="filter-select">
                    <option value="">Todos os status</option>
                    <option value="pendente">Pendente</option>
                    <option value="aprovado">Aprovado</option>
                    <option value="recusado">Recusado</option>
                    <option value="enviado">Enviado</option>
                </select>
                <select id="filterClienteOrcamento" class="filter-select">
                    <option value="">Todos os clientes</option>
                </select>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Orçamentos</h2>
                    <button class="btn btn-primary" onclick="showOrcamentoForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaOrcamentos">
                    <div class="empty-state">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <h3>Nenhum orçamento</h3>
                        <p>Crie seu primeiro orçamento</p>
                        <button class="btn btn-primary" onclick="showOrcamentoForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Criar Orçamento
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Ordens -->
        <section id="ordens" class="page">
            <div class="filter-bar">
                <select id="filterStatusOrdem" class="filter-select">
                    <option value="">Todos os status</option>
                    <option value="pendente">Pendente</option>
                    <option value="andamento">Em Andamento</option>
                    <option value="concluido">Concluído</option>
                    <option value="cancelado">Cancelado</option>
                </select>
                <select id="filterPrioridadeOrdem" class="filter-select">
                    <option value="">Todas as prioridades</option>
                    <option value="alta">Alta</option>
                    <option value="media">Média</option>
                    <option value="baixa">Baixa</option>
                </select>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-clipboard-list"></i> Ordens de Serviço</h2>
                    <button class="btn btn-primary" onclick="showOrdemForm()">
                        <i class="fas fa-plus"></i> Nova
                    </button>
                </div>
                <ul class="list" id="listaOrdens">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Nenhuma ordem</h3>
                        <p>Crie sua primeira ordem de serviço</p>
                        <button class="btn btn-primary" onclick="showOrdemForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Criar Ordem
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Agendamentos -->
        <section id="agendamentos" class="page">
            <div class="filter-bar">
                <select id="filterStatusAgendamento" class="filter-select">
                    <option value="">Todos os status</option>
                    <option value="agendado">Agendado</option>
                    <option value="confirmado">Confirmado</option>
                    <option value="concluido">Concluído</option>
                    <option value="cancelado">Cancelado</option>
                </select>
                <input type="date" id="filterDataAgendamento" class="filter-select">
            </div>
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-calendar-alt"></i> Agendamentos</h2>
                    <button class="btn btn-primary" onclick="showAgendamentoForm()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaAgendamentos">
                    <div class="empty-state">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Nenhum agendamento</h3>
                        <p>Agende seu primeiro serviço</p>
                        <button class="btn btn-primary" onclick="showAgendamentoForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Agendar Serviço
                        </button>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Financeiro -->
        <section id="financeiro" class="page">
            <!-- Financial Overview -->
            <div class="financial-grid">
                <div class="financial-card">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3 id="receitaMes">R$ 0</h3>
                    <p>Receita do Mês</p>
                </div>
                <div class="financial-card">
                    <i class="fas fa-arrow-up"></i>
                    <h3 id="lucroMes">R$ 0</h3>
                    <p>Lucro do Mês</p>
                </div>
                <div class="financial-card">
                    <i class="fas fa-hand-holding-usd"></i>
                    <h3 id="pendentes">R$ 0</h3>
                    <p>Pendentes</p>
                </div>
                <div class="financial-card">
                    <i class="fas fa-arrow-down"></i>
                    <h3 id="despesas">R$ 0</h3>
                    <p>Despesas</p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-chart-pie"></i>
                    <span>Distribuição de Receitas</span>
                </div>
                <div id="distributionChart"></div>
            </div>

            <!-- Pagamentos Pendentes -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-clock"></i> Pagamentos Pendentes</h2>
                    <button class="btn btn-primary" onclick="showFinanceModal()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                <ul class="list" id="listaPendentes">
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Nenhum pagamento pendente</h3>
                        <p>Todos os pagamentos estão em dia!</p>
                    </div>
                </ul>
            </div>

            <!-- Histórico de Pagamentos -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Histórico de Pagamentos</h2>
                    <button class="btn btn-icon" onclick="loadFinancialHistory()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <ul class="list" id="historicoPagamentos">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>Nenhum histórico</h3>
                        <p>Os pagamentos aparecerão aqui</p>
                    </div>
                </ul>
            </div>
        </section>

        <!-- Configurações -->
        <section id="configuracoes" class="page">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-cog"></i> Configurações Premium</h2>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-building"></i> Informações da Empresa</h3>
                    <form id="empresaForm">
                        <div class="form-group">
                            <label for="empresaNomeInput" class="form-required">Nome da Empresa</label>
                            <input type="text" id="empresaNomeInput" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="empresaSloganInput">Slogan</label>
                            <input type="text" id="empresaSloganInput" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="empresaTelefoneInput">Telefone</label>
                            <input type="tel" id="empresaTelefoneInput" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="empresaEmailInput">E-mail</label>
                            <input type="email" id="empresaEmailInput" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="empresaEnderecoInput">Endereço</label>
                            <textarea id="empresaEnderecoInput" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="empresaCNPJInput">CNPJ</label>
                            <input type="text" id="empresaCNPJInput" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label>Logo da Empresa</label>
                            <div class="file-input-wrapper">
                                <button type="button" class="btn btn-outline" style="width: 100%;">
                                    <i class="fas fa-upload"></i> Escolher Logo
                                </button>
                                <input type="file" id="logoUpload" accept="image/*" onchange="previewLogo(event)">
                            </div>
                            <div id="logoPreviewContainer" style="display: none;">
                                <img id="logoPreviewImg" class="logo-preview" src="" alt="Logo Preview">
                                <button type="button" class="btn btn-danger" onclick="removeLogo()" style="margin-top: 15px; width: 100%;">
                                    <i class="fas fa-trash"></i> Remover Logo
                                </button>
                            </div>
                            <small style="color: var(--gray); display: block; text-align: center; margin-top: 10px;">Tamanho recomendado: 400x400px</small>
                        </div>
                        
                        <button type="submit" class="btn btn-success" style="width: 100%; padding: 16px;">
                            <i class="fas fa-save"></i> Salvar Informações
                        </button>
                    </form>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-database"></i> Backup & Restauração</h3>
                    <p style="margin-bottom: 20px; color: var(--gray); text-align: center;">Faça backup dos seus dados ou restaure de um backup anterior.</p>
                    
                    <div class="backup-options">
                        <div class="backup-option" onclick="exportBackup()">
                            <i class="fas fa-file-export"></i>
                            <h4>Exportar Backup</h4>
                            <p>Salve todos os dados em um arquivo JSON</p>
                        </div>
                        
                        <div class="backup-option" onclick="importBackup()">
                            <i class="fas fa-file-import"></i>
                            <h4>Importar Backup</h4>
                            <p>Restaurar dados de um arquivo JSON</p>
                        </div>
                        
                        <div class="backup-option" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i>
                            <h4>Exportar para Excel</h4>
                            <p>Exportar dados em formato Excel</p>
                        </div>
                        
                        <div class="backup-option" onclick="exportFinancialReport()">
                            <i class="fas fa-chart-pie"></i>
                            <h4>Relatório Financeiro</h4>
                            <p>Gerar relatório financeiro completo</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 20px; background: rgba(67, 97, 238, 0.05); border-radius: var(--radius-sm); border: 2px solid rgba(67, 97, 238, 0.1);">
                        <h4 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-database"></i> Informações do Banco de Dados
                        </h4>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <span>Clientes:</span>
                            <span id="dbClientesCount" class="status status-aprovado">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <span>Orçamentos:</span>
                            <span id="dbOrcamentosCount" class="status status-aprovado">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <span>Ordens:</span>
                            <span id="dbOrdensCount" class="status status-aprovado">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <span>Pagamentos:</span>
                            <span id="dbPagamentosCount" class="status status-aprovado">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--gray);">
                            <strong>Total:</strong>
                            <strong id="dbTotalCount" class="status status-concluido">0 registros</strong>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="dashboard">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-home"></i>
            </div>
            <span>Início</span>
        </a>
        <a href="#" class="nav-item" data-page="clientes">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-users"></i>
            </div>
            <span>Clientes</span>
        </a>
        <a href="#" class="nav-item" data-page="orcamentos">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <span>Orçamentos</span>
        </a>
        <a href="#" class="nav-item" data-page="ordens">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <span>Ordens</span>
        </a>
        <a href="#" class="nav-item" data-page="financeiro">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <span>Financeiro</span>
        </a>
        <a href="#" class="nav-item" data-page="configuracoes">
            <span class="nav-indicator"></span>
            <div class="nav-icon">
                <i class="fas fa-cog"></i>
            </div>
            <span>Config</span>
        </a>
    </nav>

    <!-- Floating Action Button -->
    <button class="fab" id="fab" style="display: none;">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Novo Cliente</h2>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo carregado dinamicamente -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- Botões carregados dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Input de arquivo para importação -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.js"></script>
    
    <script>
        // ===== SISTEMA PREMIUM CLEANSOFT =====
        // Variáveis globais atualizadas
        let db;
        let currentPage = 'dashboard';
        let editingId = null;
        let currentFabAction = null;
        let empresaInfo = {
            nome: 'CleanSoft Pro',
            slogan: 'Excelência em Lavagem & Seco',
            telefone: '',
            email: '',
            endereco: '',
            cnpj: '',
            logo: null
        };

        // Configurações de finanças
        const financialSettings = {
            taxaImposto: 15, // 15% de impostos
            margemLucro: 25, // 25% de margem de lucro
            despesasFixas: 1500 // Despesas fixas mensais
        };

        // Inicializar gráficos
        let revenueChart, distributionChart;

        // Inicializar o app quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            initDB();
            updateDateTime();
            setInterval(updateDateTime, 60000);
            setupNavigation();
            setupFab();
            setupEventListeners();
            loadEmpresaInfo();
            initCharts();
        });

        // Inicializar IndexedDB atualizado
        function initDB() {
            const request = indexedDB.open('CleanSoftMobileDB', 5);
            
            request.onerror = function(event) {
                console.error('Erro ao abrir banco de dados:', event.target.error);
                showToast('Erro ao inicializar banco de dados. Recarregue a página.', 'error');
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                console.log('Banco de dados inicializado com sucesso');
                
                // Carregar dados iniciais
                loadDashboardData();
                loadClientes();
                loadOrcamentos();
                loadOrdens();
                loadAgendamentos();
                loadFinancialData();
                loadFilterOptions();
                updateDatabaseStats();
            };
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                const oldVersion = event.oldVersion;
                
                // Criar object stores atualizados
                if (!db.objectStoreNames.contains('clientes')) {
                    const store = db.createObjectStore('clientes', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('nome', 'nome', { unique: false });
                    store.createIndex('telefone', 'telefone', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('orcamentos')) {
                    const store = db.createObjectStore('orcamentos', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('clienteId', 'clienteId', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('data', 'data', { unique: false });
                    store.createIndex('valor', 'valor', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('ordens')) {
                    const store = db.createObjectStore('ordens', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('clienteId', 'clienteId', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('prioridade', 'prioridade', { unique: false });
                    store.createIndex('dataCriacao', 'dataCriacao', { unique: false });
                    store.createIndex('valor', 'valor', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('agendamentos')) {
                    const store = db.createObjectStore('agendamentos', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('clienteId', 'clienteId', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('data', 'data', { unique: false });
                    store.createIndex('hora', 'hora', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('atividades')) {
                    const store = db.createObjectStore('atividades', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('data', 'data', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('empresa')) {
                    db.createObjectStore('empresa', { keyPath: 'id' });
                }
                
                if (!db.objectStoreNames.contains('pagamentos')) {
                    const store = db.createObjectStore('pagamentos', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('ordemId', 'ordemId', { unique: false });
                    store.createIndex('clienteId', 'clienteId', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('data', 'data', { unique: false });
                    store.createIndex('valor', 'valor', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('despesas')) {
                    const store = db.createObjectStore('despesas', { keyPath: 'id', autoIncrement: true });
                    store.createIndex('data', 'data', { unique: false });
                    store.createIndex('categoria', 'categoria', { unique: false });
                    store.createIndex('valor', 'valor', { unique: false });
                }
                
                // Migração de dados
                if (oldVersion > 0) {
                    console.log('Migrando banco de dados da versão', oldVersion, 'para', db.version);
                }
            };
        }

        // ===== FUNÇÕES DA EMPRESA =====
        function loadEmpresaInfo() {
            if (!db) {
                setTimeout(loadEmpresaInfo, 100);
                return;
            }
            
            const transaction = db.transaction(['empresa'], 'readonly');
            const store = transaction.objectStore('empresa');
            const request = store.get('info');
            
            request.onsuccess = function() {
                if (request.result) {
                    empresaInfo = request.result.data;
                    
                    // Atualizar interface
                    document.getElementById('empresaNome').innerHTML = empresaInfo.nome.replace('Soft', '<span style="color: #4cc9f0">Soft</span>');
                    document.getElementById('empresaSlogan').textContent = empresaInfo.slogan || 'Excelência em Lavagem & Seco';
                    
                    // Preencher formulário
                    document.getElementById('empresaNomeInput').value = empresaInfo.nome;
                    document.getElementById('empresaSloganInput').value = empresaInfo.slogan || '';
                    document.getElementById('empresaTelefoneInput').value = empresaInfo.telefone || '';
                    document.getElementById('empresaEmailInput').value = empresaInfo.email || '';
                    document.getElementById('empresaEnderecoInput').value = empresaInfo.endereco || '';
                    document.getElementById('empresaCNPJInput').value = empresaInfo.cnpj || '';
                    
                    // Carregar logo se existir
                    if (empresaInfo.logo) {
                        document.getElementById('logoPreviewContainer').style.display = 'block';
                        document.getElementById('logoPreviewImg').src = empresaInfo.logo;
                        document.getElementById('logoPreview').innerHTML = `<img src="${empresaInfo.logo}" class="logo-preview">`;
                    }
                }
                
                // Configurar formulário
                document.getElementById('empresaForm').onsubmit = function(e) {
                    e.preventDefault();
                    saveEmpresaInfo();
                };
            };
        }

        function saveEmpresaInfo() {
            empresaInfo.nome = document.getElementById('empresaNomeInput').value.trim();
            empresaInfo.slogan = document.getElementById('empresaSloganInput').value.trim();
            empresaInfo.telefone = document.getElementById('empresaTelefoneInput').value.trim();
            empresaInfo.email = document.getElementById('empresaEmailInput').value.trim();
            empresaInfo.endereco = document.getElementById('empresaEnderecoInput').value.trim();
            empresaInfo.cnpj = document.getElementById('empresaCNPJInput').value.trim();
            
            if (!empresaInfo.nome) {
                showToast('O nome da empresa é obrigatório', 'warning');
                return;
            }
            
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            const transaction = db.transaction(['empresa'], 'readwrite');
            const store = transaction.objectStore('empresa');
            const request = store.put({
                id: 'info',
                data: empresaInfo,
                updatedAt: new Date().toISOString()
            });
            
            request.onsuccess = function() {
                // Atualizar header
                document.getElementById('empresaNome').innerHTML = empresaInfo.nome.replace('Soft', '<span style="color: #4cc9f0">Soft</span>');
                document.getElementById('empresaSlogan').textContent = empresaInfo.slogan || 'Excelência em Lavagem & Seco';
                
                showToast('Informações da empresa salvas com sucesso!', 'success');
            };
            
            request.onerror = function() {
                showToast('Erro ao salvar informações da empresa', 'error');
            };
        }

        // ===== GRÁFICOS =====
        function initCharts() {
            // Gráfico de receitas
            revenueChart = new ApexCharts(document.querySelector("#revenueChart"), {
                series: [{
                    name: 'Receitas',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                }],
                chart: {
                    height: 250,
                    type: 'area',
                    zoom: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    },
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif',
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: 3,
                    colors: ['#4361ee']
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.4,
                        opacityTo: 0.1,
                        stops: [0, 90, 100]
                    }
                },
                colors: ['#4361ee'],
                grid: {
                    borderColor: '#e0e0e0',
                    strokeDashArray: 3,
                    padding: {
                        top: 0,
                        right: 0,
                        bottom: 0,
                        left: 0
                    }
                },
                xaxis: {
                    categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    labels: {
                        style: {
                            colors: '#6c757d',
                            fontSize: '12px'
                        }
                    }
                },
                yaxis: {
                    labels: {
                        formatter: function(val) {
                            return "R$ " + val.toLocaleString('pt-BR', { minimumFractionDigits: 0 });
                        },
                        style: {
                            colors: '#6c757d',
                            fontSize: '12px'
                        }
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return "R$ " + val.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                        }
                    }
                }
            });
            
            revenueChart.render();
            
            // Gráfico de distribuição
            distributionChart = new ApexCharts(document.querySelector("#distributionChart"), {
                series: [44, 55, 41, 17],
                chart: {
                    height: 250,
                    type: 'donut',
                },
                colors: ['#4361ee', '#4cc9f0', '#f72585', '#f8961e'],
                labels: ['Orçamentos', 'Ordens', 'Serviços Especiais', 'Produtos'],
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total',
                                    formatter: function(w) {
                                        return "R$ 0,00"
                                    }
                                }
                            }
                        }
                    }
                },
                dataLabels: {
                    enabled: false
                },
                legend: {
                    position: 'bottom',
                    fontSize: '12px',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif',
                    labels: {
                        colors: '#212529'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return "R$ " + val.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                        }
                    }
                }
            });
            
            distributionChart.render();
        }

        // ===== FUNÇÕES DE FINANÇAS =====
        async function loadFinancialData() {
            if (!db) {
                setTimeout(loadFinancialData, 100);
                return;
            }
            
            // Calcular receita do mês
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            const ultimoDiaMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
            
            // Receita de ordens concluídas
            const ordensTransaction = db.transaction(['ordens'], 'readonly');
            const ordensStore = ordensTransaction.objectStore('ordens');
            const todasOrdens = await new Promise(resolve => {
                const request = ordensStore.getAll();
                request.onsuccess = () => resolve(request.result);
            });
            
            const receitaMes = todasOrdens
                .filter(o => o.status === 'concluido' && new Date(o.dataConclusao) >= primeiroDiaMes)
                .reduce((total, ordem) => total + (ordem.valor || 0), 0);
            
            // Calcular lucro
            const despesasMes = financialSettings.despesasFixas;
            const lucroMes = receitaMes - despesasMes;
            
            // Calcular pendentes
            const pendentes = todasOrdens
                .filter(o => o.status !== 'concluido' && o.status !== 'cancelado')
                .reduce((total, ordem) => total + (ordem.valor || 0), 0);
            
            // Atualizar UI
            document.getElementById('receitaTotal').textContent = 'R$ ' + todasOrdens
                .filter(o => o.status === 'concluido')
                .reduce((total, ordem) => total + (ordem.valor || 0), 0)
                .toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            
            document.getElementById('receitaMes').textContent = 'R$ ' + receitaMes.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('lucroMes').textContent = 'R$ ' + lucroMes.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('pendentes').textContent = 'R$ ' + pendentes.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            document.getElementById('despesas').textContent = 'R$ ' + despesasMes.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            
            // Atualizar gráfico de receitas
            updateRevenueChart();
            
            // Carregar pagamentos pendentes
            loadPagamentosPendentes();
            
            // Carregar histórico
            loadFinancialHistory();
        }

        function updateRevenueChart() {
            if (!db || !revenueChart) return;
            
            // Em um sistema real, aqui viriam os dados reais por mês
            // Por enquanto, vamos gerar dados fictícios
            const meses = [];
            const receitas = [];
            
            for (let i = 0; i < 12; i++) {
                meses.push(i);
                receitas.push(Math.floor(Math.random() * 10000) + 1000);
            }
            
            revenueChart.updateSeries([{
                data: receitas
            }]);
        }

        function loadPagamentosPendentes() {
            if (!db) return;
            
            const transaction = db.transaction(['ordens'], 'readonly');
            const store = transaction.objectStore('ordens');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const ordens = request.result || [];
                const pendentes = ordens.filter(o => 
                    o.status !== 'concluido' && 
                    o.status !== 'cancelado' &&
                    o.valor > 0
                );
                
                displayPagamentosPendentes(pendentes);
            };
        }

        function displayPagamentosPendentes(ordens) {
            const container = document.getElementById('listaPendentes');
            if (!container) return;
            
            if (!ordens || ordens.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Nenhum pagamento pendente</h3>
                        <p>Todos os pagamentos estão em dia!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            ordens.forEach(ordem => {
                const li = document.createElement('li');
                li.className = 'list-item';
                
                // Buscar nome do cliente
                if (!db) return;
                
                const clienteTransaction = db.transaction(['clientes'], 'readonly');
                const clienteStore = clienteTransaction.objectStore('clientes');
                const clienteRequest = clienteStore.get(ordem.clienteId);
                
                clienteRequest.onsuccess = function() {
                    const cliente = clienteRequest.result || {};
                    
                    li.innerHTML = `
                        <div class="list-item-content">
                            <h3>Ordem #${ordem.id}</h3>
                            <p><i class="fas fa-user"></i> ${cliente.nome || 'Cliente não encontrado'}</p>
                            <p style="font-size: 0.9rem; color: var(--warning); font-weight: bold; margin-top: 5px;">
                                <i class="fas fa-clock"></i> Vence em ${ordem.dataPrazo}
                            </p>
                            <span class="status status-${ordem.status}">${ordem.status}</span>
                        </div>
                        <div class="list-item-actions">
                            <span style="font-size: 1.2rem; font-weight: 800; color: var(--danger);">
                                R$ ${ordem.valor.toFixed(2)}
                            </span>
                        </div>
                    `;
                    
                    container.appendChild(li);
                };
            });
        }

        function loadFinancialHistory() {
            if (!db) return;
            
            // Carregar ordens concluídas como histórico de pagamentos
            const transaction = db.transaction(['ordens'], 'readonly');
            const store = transaction.objectStore('ordens');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const ordens = request.result || [];
                const historico = ordens
                    .filter(o => o.status === 'concluido' && o.dataConclusao)
                    .sort((a, b) => new Date(b.dataConclusao) - new Date(a.dataConclusao))
                    .slice(0, 10); // Mostrar apenas os 10 mais recentes
                
                displayFinancialHistory(historico);
            };
        }

        function displayFinancialHistory(ordens) {
            const container = document.getElementById('historicoPagamentos');
            if (!container) return;
            
            if (!ordens || ordens.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>Nenhum histórico</h3>
                        <p>Os pagamentos aparecerão aqui</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            ordens.forEach(ordem => {
                const li = document.createElement('li');
                li.className = 'list-item';
                
                // Buscar nome do cliente
                if (!db) return;
                
                const clienteTransaction = db.transaction(['clientes'], 'readonly');
                const clienteStore = clienteTransaction.objectStore('clientes');
                const clienteRequest = clienteStore.get(ordem.clienteId);
                
                clienteRequest.onsuccess = function() {
                    const cliente = clienteRequest.result || {};
                    const data = new Date(ordem.dataConclusao);
                    const dataStr = data.toLocaleDateString('pt-BR');
                    
                    li.innerHTML = `
                        <div class="list-item-content">
                            <h3>Ordem #${ordem.id}</h3>
                            <p><i class="fas fa-user"></i> ${cliente.nome || 'Cliente não encontrado'}</p>
                            <p style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">
                                <i class="fas fa-calendar"></i> ${dataStr}
                            </p>
                        </div>
                        <div class="list-item-actions">
                            <span style="font-size: 1.2rem; font-weight: 800; color: var(--success);">
                                R$ ${ordem.valor.toFixed(2)}
                            </span>
                            <span class="status status-concluido" style="margin-left: 10px;">Pago</span>
                        </div>
                    `;
                    
                    container.appendChild(li);
                };
            });
        }

        function showFinanceModal() {
            document.getElementById('modalTitle').textContent = 'Registrar Pagamento';
            
            // Carregar ordens pendentes
            if (!db) return;
            
            const transaction = db.transaction(['ordens'], 'readonly');
            const store = transaction.objectStore('ordens');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const ordens = request.result || [];
                const ordensPendentes = ordens.filter(o => o.status !== 'concluido' && o.status !== 'cancelado');
                
                let ordemOptions = '<option value="">Selecione uma ordem</option>';
                ordensPendentes.forEach(ordem => {
                    ordemOptions += `<option value="${ordem.id}">Ordem #${ordem.id} - R$ ${ordem.valor.toFixed(2)}</option>`;
                });
                
                const formHTML = `
                    <div class="form-group">
                        <label for="pagamentoOrdemId" class="form-required">Ordem</label>
                        <select id="pagamentoOrdemId" class="form-control" required>
                            ${ordemOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pagamentoValor" class="form-required">Valor (R$)</label>
                        <input type="number" id="pagamentoValor" class="form-control" step="0.01" min="0" placeholder="0,00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="pagamentoMetodo" class="form-required">Método de Pagamento</label>
                        <select id="pagamentoMetodo" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="dinheiro">Dinheiro</option>
                            <option value="pix">PIX</option>
                            <option value="cartao_credito">Cartão de Crédito</option>
                            <option value="cartao_debito">Cartão de Débito</option>
                            <option value="transferencia">Transferência</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pagamentoData">Data</label>
                        <input type="date" id="pagamentoData" class="form-control" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    
                    <div class="form-group">
                        <label for="pagamentoObservacoes">Observações</label>
                        <textarea id="pagamentoObservacoes" class="form-control" placeholder="Observações sobre o pagamento" rows="3"></textarea>
                    </div>
                `;
                
                const footerHTML = `
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="registrarPagamento()">
                        <i class="fas fa-check"></i> Registrar Pagamento
                    </button>
                `;
                
                document.getElementById('modalBody').innerHTML = formHTML;
                document.getElementById('modalFooter').innerHTML = footerHTML;
                
                openModal();
                
                // Atualizar valor quando selecionar uma ordem
                document.getElementById('pagamentoOrdemId').addEventListener('change', function() {
                    const ordemId = this.value;
                    const ordem = ordensPendentes.find(o => o.id == ordemId);
                    if (ordem) {
                        document.getElementById('pagamentoValor').value = ordem.valor;
                    }
                });
            };
        }

        function registrarPagamento() {
            const ordemId = document.getElementById('pagamentoOrdemId').value;
            const valor = parseFloat(document.getElementById('pagamentoValor').value) || 0;
            const metodo = document.getElementById('pagamentoMetodo').value;
            const data = document.getElementById('pagamentoData').value;
            const observacoes = document.getElementById('pagamentoObservacoes').value.trim();
            
            if (!ordemId || !valor || !metodo) {
                showToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }
            
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            // Buscar a ordem
            const transaction = db.transaction(['ordens'], 'readwrite');
            const store = transaction.objectStore('ordens');
            const request = store.get(parseInt(ordemId));
            
            request.onsuccess = function() {
                const ordem = request.result;
                if (!ordem) {
                    showToast('Ordem não encontrada', 'error');
                    return;
                }
                
                // Atualizar status da ordem para concluído
                ordem.status = 'concluido';
                ordem.dataConclusao = new Date().toISOString();
                ordem.metodoPagamento = metodo;
                
                // Salvar a ordem atualizada
                store.put(ordem).onsuccess = function() {
                    // Registrar pagamento
                    const pagamento = {
                        ordemId: parseInt(ordemId),
                        clienteId: ordem.clienteId,
                        valor: valor,
                        metodo: metodo,
                        data: data || new Date().toISOString().split('T')[0],
                        observacoes: observacoes,
                        status: 'concluido',
                        dataRegistro: new Date().toISOString()
                    };
                    
                    const pagamentoTransaction = db.transaction(['pagamentos'], 'readwrite');
                    const pagamentoStore = pagamentoTransaction.objectStore('pagamentos');
                    pagamentoStore.add(pagamento);
                    
                    showToast('Pagamento registrado com sucesso!', 'success');
                    closeModal();
                    
                    // Recarregar dados
                    loadOrdens();
                    loadFinancialData();
                    loadDashboardData();
                    updateDatabaseStats();
                    
                    // Buscar nome do cliente para atividade
                    const clienteTransaction = db.transaction(['clientes'], 'readonly');
                    const clienteStore = clienteTransaction.objectStore('clientes');
                    const clienteRequest = clienteStore.get(ordem.clienteId);
                    
                    clienteRequest.onsuccess = function() {
                        const cliente = clienteRequest.result || {};
                        addAtividade('pagamento', 'Pagamento registrado', cliente.nome, 'concluido');
                    };
                };
            };
        }

        // ===== FUNÇÕES EXISTENTES (OTIMIZADAS) =====
        function updateDateTime() {
            try {
                const now = new Date();
                
                // Formatar data
                const optionsDate = { weekday: 'short', day: '2-digit', month: 'short' };
                const dateStr = now.toLocaleDateString('pt-BR', optionsDate);
                document.getElementById('currentDate').textContent = dateStr;
                
                // Formatar hora
                const timeStr = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('currentTime').textContent = timeStr;
            } catch (e) {
                console.error('Erro ao atualizar data/hora:', e);
            }
        }

        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Atualizar navegação ativa
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar página correspondente
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Atualizar título
                    const pageTitle = this.querySelector('span').textContent;
                    document.getElementById('pageTitle').textContent = pageTitle;
                    
                    // Atualizar FAB
                    updateFab(pageId);
                });
            });
        }

        function setupFab() {
            const fab = document.getElementById('fab');
            if (fab) {
                fab.addEventListener('click', function() {
                    if (currentFabAction && typeof currentFabAction === 'function') {
                        currentFabAction();
                    }
                });
            }
        }

        function setupEventListeners() {
            // Busca de clientes
            const searchInput = document.getElementById('searchCliente');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    loadClientes(this.value);
                });
            }
            
            // Filtros
            document.getElementById('filterStatusOrcamento')?.addEventListener('change', loadOrcamentos);
            document.getElementById('filterClienteOrcamento')?.addEventListener('change', loadOrcamentos);
            document.getElementById('filterStatusOrdem')?.addEventListener('change', loadOrdens);
            document.getElementById('filterPrioridadeOrdem')?.addEventListener('change', loadOrdens);
            document.getElementById('filterStatusAgendamento')?.addEventListener('change', loadAgendamentos);
            document.getElementById('filterDataAgendamento')?.addEventListener('change', loadAgendamentos);
        }

        function updateFab(pageId) {
            const fab = document.getElementById('fab');
            if (!fab) return;
            
            switch(pageId) {
                case 'clientes':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-user-plus"></i>';
                    currentFabAction = showClienteForm;
                    break;
                case 'orcamentos':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-file-invoice-dollar"></i>';
                    currentFabAction = showOrcamentoForm;
                    break;
                case 'ordens':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-clipboard-check"></i>';
                    currentFabAction = showOrdemForm;
                    break;
                case 'agendamentos':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-calendar-plus"></i>';
                    currentFabAction = showAgendamentoForm;
                    break;
                case 'financeiro':
                    fab.style.display = 'flex';
                    fab.innerHTML = '<i class="fas fa-hand-holding-usd"></i>';
                    currentFabAction = showFinanceModal;
                    break;
                case 'configuracoes':
                    fab.style.display = 'none';
                    currentFabAction = null;
                    break;
                default:
                    fab.style.display = 'none';
                    currentFabAction = null;
            }
        }

        function showPage(pageId) {
            // Esconder todas as páginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar página solicitada
            const pageElement = document.getElementById(pageId);
            if (pageElement) {
                pageElement.classList.add('active');
                currentPage = pageId;
                
                // Carregar dados da página se necessário
                switch(pageId) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'clientes':
                        loadClientes();
                        break;
                    case 'orcamentos':
                        loadOrcamentos();
                        break;
                    case 'ordens':
                        loadOrdens();
                        break;
                    case 'agendamentos':
                        loadAgendamentos();
                        break;
                    case 'financeiro':
                        loadFinancialData();
                        break;
                    case 'configuracoes':
                        updateDatabaseStats();
                        break;
                }
            }
        }

        async function loadDashboardData() {
            if (!db) {
                setTimeout(loadDashboardData, 100);
                return;
            }
            
            // Contar clientes
            countRecords('clientes', 'totalClientes');
            
            // Calcular receita total
            const ordensTransaction = db.transaction(['ordens'], 'readonly');
            const ordensStore = ordensTransaction.objectStore('ordens');
            const todasOrdens = await new Promise(resolve => {
                const request = ordensStore.getAll();
                request.onsuccess = () => resolve(request.result);
            });
            
            const receitaTotal = todasOrdens
                .filter(o => o.status === 'concluido')
                .reduce((total, ordem) => total + (ordem.valor || 0), 0);
            
            document.getElementById('receitaTotal').textContent = 'R$ ' + receitaTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            
            // Contar ordens ativas
            const ordensAtivas = todasOrdens.filter(o => o.status !== 'concluido' && o.status !== 'cancelado').length;
            document.getElementById('totalOrdens').textContent = ordensAtivas;
            
            // Contar agendamentos de hoje
            countTodayAgendamentos();
            
            // Atualizar trends (fictícios para demonstração)
            document.getElementById('clientesTrend').innerHTML = `<i class="fas fa-arrow-up"></i> <span>${Math.floor(Math.random() * 10) + 5}%</span>`;
            document.getElementById('receitaTrend').innerHTML = `<i class="fas fa-arrow-up"></i> <span>${Math.floor(Math.random() * 15) + 10}%</span>`;
            document.getElementById('ordensTrend').innerHTML = `<i class="fas fa-arrow-down"></i> <span>${Math.floor(Math.random() * 5) + 1}%</span>`;
            
            loadRecentActivities();
        }

        function countTodayAgendamentos() {
            if (!db) return;
            
            const today = new Date().toISOString().split('T')[0];
            const transaction = db.transaction(['agendamentos'], 'readonly');
            const store = transaction.objectStore('agendamentos');
            const index = store.index('data');
            const range = IDBKeyRange.only(today);
            
            const request = index.count(range);
            
            request.onsuccess = function() {
                const element = document.getElementById('totalAgendamentos');
                if (element) {
                    element.textContent = request.result;
                }
            };
        }

        // ===== BACKUP & EXPORTAÇÃO ATUALIZADA =====
        function exportFinancialReport() {
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            const workbook = XLSX.utils.book_new();
            
            // Coletar dados para o relatório
            Promise.all([
                getStoreData('clientes'),
                getStoreData('ordens'),
                getStoreData('orcamentos'),
                getStoreData('pagamentos')
            ]).then(([clientes, ordens, orcamentos, pagamentos]) => {
                // Resumo Financeiro
                const receitaTotal = ordens
                    .filter(o => o.status === 'concluido')
                    .reduce((total, ordem) => total + (ordem.valor || 0), 0);
                
                const pendentes = ordens
                    .filter(o => o.status !== 'concluido' && o.status !== 'cancelado')
                    .reduce((total, ordem) => total + (ordem.valor || 0), 0);
                
                const relatorio = [{
                    'Tipo': 'Receita Total',
                    'Valor': receitaTotal,
                    'Descrição': 'Total recebido em ordens concluídas'
                }, {
                    'Tipo': 'Pendentes',
                    'Valor': pendentes,
                    'Descrição': 'Valor total em ordens pendentes'
                }, {
                    'Tipo': 'Clientes Ativos',
                    'Valor': clientes.length,
                    'Descrição': 'Total de clientes cadastrados'
                }, {
                    'Tipo': 'Ordens Concluídas',
                    'Valor': ordens.filter(o => o.status === 'concluido').length,
                    'Descrição': 'Total de ordens finalizadas'
                }];
                
                // Criar worksheets
                const wsRelatorio = XLSX.utils.json_to_sheet(relatorio);
                const wsClientes = XLSX.utils.json_to_sheet(clientes.map(c => ({
                    'ID': c.id,
                    'Nome': c.nome,
                    'Telefone': c.telefone,
                    'Email': c.email,
                    'Data Cadastro': c.dataCadastro ? new Date(c.dataCadastro).toLocaleDateString('pt-BR') : '',
                    'Status': c.status || 'ativo'
                })));
                
                const wsOrdens = XLSX.utils.json_to_sheet(ordens.map(o => ({
                    'ID': o.id,
                    'Cliente ID': o.clienteId,
                    'Serviços': o.servicos.substring(0, 50) + (o.servicos.length > 50 ? '...' : ''),
                    'Valor': o.valor,
                    'Status': o.status,
                    'Prioridade': o.prioridade,
                    'Data Criação': o.dataCriacao ? new Date(o.dataCriacao).toLocaleDateString('pt-BR') : '',
                    'Data Conclusão': o.dataConclusao ? new Date(o.dataConclusao).toLocaleDateString('pt-BR') : ''
                })));
                
                const wsPagamentos = XLSX.utils.json_to_sheet(pagamentos.map(p => ({
                    'ID': p.id,
                    'Ordem ID': p.ordemId,
                    'Cliente ID': p.clienteId,
                    'Valor': p.valor,
                    'Método': p.metodo,
                    'Data': p.data,
                    'Status': p.status
                })));
                
                // Adicionar worksheets ao workbook
                XLSX.utils.book_append_sheet(workbook, wsRelatorio, 'Relatório');
                XLSX.utils.book_append_sheet(workbook, wsClientes, 'Clientes');
                XLSX.utils.book_append_sheet(workbook, wsOrdens, 'Ordens');
                XLSX.utils.book_append_sheet(workbook, wsPagamentos, 'Pagamentos');
                
                // Gerar arquivo Excel
                const hoje = new Date().toISOString().split('T')[0];
                XLSX.writeFile(workbook, `relatorio_financeiro_${empresaInfo.nome.replace(/\s+/g, '_')}_${hoje}.xlsx`);
                
                showToast('Relatório financeiro gerado com sucesso!', 'success');
            });
        }

        function getStoreData(storeName) {
            return new Promise(resolve => {
                if (!db) {
                    resolve([]);
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = function() {
                    resolve(request.result || []);
                };
                
                request.onerror = function() {
                    resolve([]);
                };
            });
        }

        function updateDatabaseStats() {
            if (!db) return;
            
            const stores = ['clientes', 'orcamentos', 'ordens', 'pagamentos', 'agendamentos'];
            let total = 0;
            
            stores.forEach((storeName, index) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.count();
                
                request.onsuccess = function() {
                    const count = request.result;
                    total += count;
                    
                    // Atualizar elemento específico
                    const elementId = 'db' + storeName.charAt(0).toUpperCase() + storeName.slice(1) + 'Count';
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = count;
                    }
                    
                    // Se for o último, atualizar total
                    if (index === stores.length - 1) {
                        setTimeout(() => {
                            document.getElementById('dbTotalCount').textContent = total + ' registros';
                        }, 100);
                    }
                };
            });
        }

        // ===== FUNÇÕES DE MODAL (MANTIDAS) =====
        function openModal() {
            const modal = document.getElementById('modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if (modal) {
                modal.classList.remove('active');
                editingId = null;
                document.getElementById('modalBody').innerHTML = '';
                document.getElementById('modalFooter').innerHTML = '';
                document.body.style.overflow = '';
            }
        }

        // ===== FUNÇÕES DE CLIENTES (OTIMIZADAS) =====
        function showClienteForm(cliente = null) {
            editingId = cliente ? cliente.id : null;
            
            document.getElementById('modalTitle').textContent = cliente ? 'Editar Cliente' : 'Novo Cliente';
            
            const formHTML = `
                <div class="form-group">
                    <label for="clienteNome" class="form-required">Nome</label>
                    <input type="text" id="clienteNome" class="form-control" value="${cliente ? cliente.nome : ''}" placeholder="Nome completo" required>
                </div>
                
                <div class="form-group">
                    <label for="clienteTelefone" class="form-required">Telefone</label>
                    <input type="tel" id="clienteTelefone" class="form-control" value="${cliente ? cliente.telefone : ''}" placeholder="(11) 99999-9999" required>
                </div>
                
                <div class="form-group">
                    <label for="clienteEmail">E-mail</label>
                    <input type="email" id="clienteEmail" class="form-control" value="${cliente ? cliente.email || '' : ''}" placeholder="email@exemplo.com">
                </div>
                
                <div class="form-group">
                    <label for="clienteEndereco">Endereço</label>
                    <textarea id="clienteEndereco" class="form-control" placeholder="Endereço completo" rows="2">${cliente ? cliente.endereco || '' : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="clienteObservacoes">Observações</label>
                    <textarea id="clienteObservacoes" class="form-control" placeholder="Observações sobre o cliente" rows="2">${cliente ? cliente.observacoes || '' : ''}</textarea>
                </div>
            `;
            
            const footerHTML = `
                <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="saveCliente()">Salvar</button>
            `;
            
            document.getElementById('modalBody').innerHTML = formHTML;
            document.getElementById('modalFooter').innerHTML = footerHTML;
            
            openModal();
            
            // Focar no primeiro campo
            setTimeout(() => {
                const nomeInput = document.getElementById('clienteNome');
                if (nomeInput) nomeInput.focus();
            }, 300);
        }

        function saveCliente() {
            const nome = document.getElementById('clienteNome').value.trim();
            const telefone = document.getElementById('clienteTelefone').value.trim();
            const email = document.getElementById('clienteEmail').value.trim();
            const endereco = document.getElementById('clienteEndereco').value.trim();
            const observacoes = document.getElementById('clienteObservacoes').value.trim();
            
            // Validação básica
            if (!nome || !telefone) {
                showToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }
            
            const cliente = {
                nome: nome,
                telefone: telefone,
                email: email,
                endereco: endereco,
                observacoes: observacoes,
                status: 'ativo',
                dataCadastro: new Date().toISOString()
            };
            
            if (editingId) {
                cliente.id = editingId;
            }
            
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            const transaction = db.transaction(['clientes'], 'readwrite');
            const store = transaction.objectStore('clientes');
            
            const request = editingId ? store.put(cliente) : store.add(cliente);
            
            request.onsuccess = function() {
                showToast('Cliente salvo com sucesso!', 'success');
                closeModal();
                loadClientes();
                loadDashboardData();
                loadFilterOptions();
                updateDatabaseStats();
                
                // Adicionar atividade
                addAtividade('cliente', editingId ? 'Cliente atualizado' : 'Novo cliente cadastrado', cliente.nome);
            };
            
            request.onerror = function() {
                showToast('Erro ao salvar cliente', 'error');
            };
        }

        function loadClientes(searchTerm = '') {
            if (!db) {
                setTimeout(() => loadClientes(searchTerm), 100);
                return;
            }
            
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.getAll();
            
            request.onsuccess = function() {
                let clientes = request.result || [];
                
                // Aplicar filtro de busca
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    clientes = clientes.filter(cliente => 
                        cliente.nome.toLowerCase().includes(term) ||
                        cliente.telefone.includes(searchTerm) ||
                        (cliente.email && cliente.email.toLowerCase().includes(term))
                    );
                }
                
                displayClientes(clientes);
            };
            
            request.onerror = function() {
                console.error('Erro ao carregar clientes');
                showToast('Erro ao carregar clientes', 'error');
            };
        }

        function displayClientes(clientes) {
            const container = document.getElementById('listaClientes');
            if (!container) return;
            
            if (!clientes || clientes.length === 0) {
                const searchTerm = document.getElementById('searchCliente')?.value || '';
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>${searchTerm ? 'Nenhum cliente encontrado' : 'Nenhum cliente cadastrado'}</h3>
                        <p>${searchTerm ? 'Tente buscar com outros termos' : 'Adicione seu primeiro cliente'}</p>
                        <button class="btn btn-primary" onclick="showClienteForm()" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Adicionar Cliente
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            clientes.forEach(cliente => {
                const li = document.createElement('li');
                li.className = 'list-item';
                
                li.innerHTML = `
                    <div class="list-item-content">
                        <h3>${cliente.nome}</h3>
                        <p><i class="fas fa-phone"></i> ${cliente.telefone} ${cliente.email ? `• <i class="fas fa-envelope"></i> ${cliente.email}` : ''}</p>
                        ${cliente.endereco ? `<p style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;"><i class="fas fa-map-marker-alt"></i> ${cliente.endereco.substring(0, 40)}${cliente.endereco.length > 40 ? '...' : ''}</p>` : ''}
                    </div>
                    <div class="list-item-actions">
                        <button class="icon-btn edit" onclick="editCliente(${cliente.id})" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn delete" onclick="deleteCliente(${cliente.id})" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(li);
            });
        }

        function editCliente(id) {
            if (!db) return;
            
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.get(id);
            
            request.onsuccess = function() {
                if (request.result) {
                    showClienteForm(request.result);
                }
            };
        }

        function deleteCliente(id) {
            if (!confirm('Tem certeza que deseja excluir este cliente?')) return;
            
            if (!db) return;
            
            const transaction = db.transaction(['clientes'], 'readwrite');
            const store = transaction.objectStore('clientes');
            const request = store.delete(id);
            
            request.onsuccess = function() {
                showToast('Cliente excluído com sucesso', 'success');
                loadClientes();
                loadDashboardData();
                loadFilterOptions();
                updateDatabaseStats();
                addAtividade('cliente', 'Cliente excluído');
            };
        }

        // ===== FUNÇÕES DE ORÇAMENTOS (OTIMIZADAS) =====
        function showOrcamentoForm(orcamento = null) {
            editingId = orcamento ? orcamento.id : null;
            
            document.getElementById('modalTitle').textContent = orcamento ? 'Editar Orçamento' : 'Novo Orçamento';
            
            // Primeiro carregar clientes
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const clientes = request.result || [];
                const clientesOptions = clientes.map(c => 
                    `<option value="${c.id}" ${orcamento && orcamento.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
                ).join('');
                
                const formHTML = `
                    <div class="form-group">
                        <label for="orcamentoClienteId" class="form-required">Cliente</label>
                        <select id="orcamentoClienteId" class="form-control" required>
                            <option value="">Selecione um cliente</option>
                            ${clientesOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="orcamentoServicos" class="form-required">Serviços</label>
                        <textarea id="orcamentoServicos" class="form-control" placeholder="Descreva os serviços a serem realizados" required rows="3">${orcamento ? orcamento.servicos : ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="orcamentoValor" class="form-required">Valor (R$)</label>
                        <input type="number" id="orcamentoValor" class="form-control" step="0.01" min="0" value="${orcamento ? orcamento.valor : ''}" placeholder="0,00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="orcamentoValidade" class="form-required">Validade (dias)</label>
                        <input type="number" id="orcamentoValidade" class="form-control" min="1" max="30" value="${orcamento ? orcamento.validade || 7 : 7}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="orcamentoStatus">Status</label>
                        <select id="orcamentoStatus" class="form-control">
                            <option value="pendente" ${orcamento && orcamento.status === 'pendente' ? 'selected' : 'selected'}>Pendente</option>
                            <option value="aprovado" ${orcamento && orcamento.status === 'aprovado' ? 'selected' : ''}>Aprovado</option>
                            <option value="recusado" ${orcamento && orcamento.status === 'recusado' ? 'selected' : ''}>Recusado</option>
                            <option value="enviado" ${orcamento && orcamento.status === 'enviado' ? 'selected' : ''}>Enviado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="orcamentoObservacoes">Observações</label>
                        <textarea id="orcamentoObservacoes" class="form-control" placeholder="Observações adicionais" rows="2">${orcamento ? orcamento.observacoes || '' : ''}</textarea>
                    </div>
                `;
                
                const footerHTML = `
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="saveOrcamento()">Salvar</button>
                    ${orcamento ? `<button type="button" class="btn btn-primary" onclick="converterParaOrdem(${orcamento.id})">
                        <i class="fas fa-exchange-alt"></i> Converter para Ordem
                    </button>` : ''}
                `;
                
                document.getElementById('modalBody').innerHTML = formHTML;
                document.getElementById('modalFooter').innerHTML = footerHTML;
                
                openModal();
            };
        }

        // ===== FUNÇÕES DE ORDENS (OTIMIZADAS) =====
        function showOrdemForm(ordem = null) {
            editingId = ordem ? ordem.id : null;
            
            document.getElementById('modalTitle').textContent = ordem ? 'Editar Ordem de Serviço' : 'Nova Ordem de Serviço';
            
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            // Carregar clientes
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const clientes = request.result || [];
                const clientesOptions = clientes.map(c => 
                    `<option value="${c.id}" ${ordem && ordem.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
                ).join('');
                
                const hoje = new Date().toISOString().split('T')[0];
                const prazoPadrao = ordem ? ordem.dataPrazo : new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                const formHTML = `
                    <div class="form-group">
                        <label for="ordemClienteId" class="form-required">Cliente</label>
                        <select id="ordemClienteId" class="form-control" required>
                            <option value="">Selecione um cliente</option>
                            ${clientesOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemServicos" class="form-required">Serviços</label>
                        <textarea id="ordemServicos" class="form-control" placeholder="Descreva os serviços a serem realizados" required rows="3">${ordem ? ordem.servicos : ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemValor" class="form-required">Valor (R$)</label>
                        <input type="number" id="ordemValor" class="form-control" step="0.01" min="0" value="${ordem ? ordem.valor : ''}" placeholder="0,00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemPrioridade" class="form-required">Prioridade</label>
                        <select id="ordemPrioridade" class="form-control" required>
                            <option value="alta" ${ordem && ordem.prioridade === 'alta' ? 'selected' : ''}>Alta</option>
                            <option value="media" ${ordem && ordem.prioridade === 'media' ? 'selected' : (ordem ? '' : 'selected')}>Média</option>
                            <option value="baixa" ${ordem && ordem.prioridade === 'baixa' ? 'selected' : ''}>Baixa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemStatus" class="form-required">Status</label>
                        <select id="ordemStatus" class="form-control" required>
                            <option value="pendente" ${ordem && ordem.status === 'pendente' ? 'selected' : 'selected'}>Pendente</option>
                            <option value="andamento" ${ordem && ordem.status === 'andamento' ? 'selected' : ''}>Em Andamento</option>
                            <option value="concluido" ${ordem && ordem.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                            <option value="cancelado" ${ordem && ordem.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemDataPrazo" class="form-required">Prazo de Conclusão</label>
                        <input type="date" id="ordemDataPrazo" class="form-control" value="${prazoPadrao}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="ordemObservacoes">Observações</label>
                        <textarea id="ordemObservacoes" class="form-control" placeholder="Observações adicionais" rows="2">${ordem ? ordem.observacoes || '' : ''}</textarea>
                    </div>
                `;
                
                const footerHTML = `
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="saveOrdem()">Salvar</button>
                `;
                
                document.getElementById('modalBody').innerHTML = formHTML;
                document.getElementById('modalFooter').innerHTML = footerHTML;
                
                openModal();
            };
        }

        // ===== FUNÇÕES DE AGENDAMENTOS (OTIMIZADAS) =====
        function showAgendamentoForm(agendamento = null) {
            editingId = agendamento ? agendamento.id : null;
            
            document.getElementById('modalTitle').textContent = agendamento ? 'Editar Agendamento' : 'Novo Agendamento';
            
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            // Carregar clientes
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const clientes = request.result || [];
                const clientesOptions = clientes.map(c => 
                    `<option value="${c.id}" ${agendamento && agendamento.clienteId == c.id ? 'selected' : ''}>${c.nome}</option>`
                ).join('');
                
                const amanha = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                const dataAtual = agendamento ? agendamento.data : amanha;
                const horaAtual = agendamento ? agendamento.hora : '09:00';
                
                // Gerar opções de horário
                let timeOptions = '';
                for (let hour = 8; hour <= 18; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        timeOptions += `<option value="${time}" ${time === horaAtual ? 'selected' : ''}>${time}</option>`;
                    }
                }
                
                const formHTML = `
                    <div class="form-group">
                        <label for="agendamentoClienteId" class="form-required">Cliente</label>
                        <select id="agendamentoClienteId" class="form-control" required onchange="carregarOrdensCliente(this.value)">
                            <option value="">Selecione um cliente</option>
                            ${clientesOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoOrdemId">Ordem Relacionada (opcional)</label>
                        <select id="agendamentoOrdemId" class="form-control">
                            <option value="">Nenhuma ordem</option>
                            ${agendamento && agendamento.ordemId ? `<option value="${agendamento.ordemId}" selected>Ordem #${agendamento.ordemId}</option>` : ''}
                        </select>
                        <small style="color: var(--gray);">Selecione uma ordem em aberto para vincular ao agendamento</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoData" class="form-required">Data</label>
                        <input type="date" id="agendamentoData" class="form-control" value="${dataAtual}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoHora" class="form-required">Hora</label>
                        <select id="agendamentoHora" class="form-control" required>
                            <option value="">Selecione um horário</option>
                            ${timeOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoServicos" class="form-required">Serviços</label>
                        <textarea id="agendamentoServicos" class="form-control" placeholder="Descreva os serviços agendados" required rows="3">${agendamento ? agendamento.servicos : ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoDuracao" class="form-required">Duração Estimada (horas)</label>
                        <input type="number" id="agendamentoDuracao" class="form-control" min="1" max="8" value="${agendamento ? agendamento.duracao || 1 : 1}" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoStatus">Status</label>
                        <select id="agendamentoStatus" class="form-control">
                            <option value="agendado" ${agendamento && agendamento.status === 'agendado' ? 'selected' : 'selected'}>Agendado</option>
                            <option value="confirmado" ${agendamento && agendamento.status === 'confirmado' ? 'selected' : ''}>Confirmado</option>
                            <option value="concluido" ${agendamento && agendamento.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                            <option value="cancelado" ${agendamento && agendamento.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoObservacoes">Observações</label>
                        <textarea id="agendamentoObservacoes" class="form-control" placeholder="Observações adicionais" rows="2">${agendamento ? agendamento.observacoes || '' : ''}</textarea>
                    </div>
                `;
                
                const footerHTML = `
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="saveAgendamento()">Salvar</button>
                `;
                
                document.getElementById('modalBody').innerHTML = formHTML;
                document.getElementById('modalFooter').innerHTML = footerHTML;
                
                openModal();
                
                // Carregar ordens se já tiver cliente selecionado
                if (agendamento && agendamento.clienteId) {
                    setTimeout(() => carregarOrdensCliente(agendamento.clienteId), 300);
                }
            };
        }

        // ===== FUNÇÕES DE ATIVIDADES (OTIMIZADAS) =====
        function addAtividade(tipo, descricao, clienteNome = '', status = '') {
            if (!db) return;
            
            const atividade = {
                tipo: tipo,
                descricao: descricao,
                clienteNome: clienteNome,
                status: status,
                data: new Date().toISOString()
            };
            
            const transaction = db.transaction(['atividades'], 'readwrite');
            const store = transaction.objectStore('atividades');
            store.add(atividade);
            
            // Atualizar lista de atividades
            loadRecentActivities();
        }

        function loadRecentActivities() {
            if (!db) {
                setTimeout(loadRecentActivities, 100);
                return;
            }
            
            const transaction = db.transaction(['atividades'], 'readonly');
            const store = transaction.objectStore('atividades');
            const index = store.index('data');
            
            const request = index.openCursor(null, 'prev');
            const atividades = [];
            
            request.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor && atividades.length < 10) {
                    atividades.push(cursor.value);
                    cursor.continue();
                } else {
                    displayRecentActivities(atividades);
                }
            };
        }

        function displayRecentActivities(atividades) {
            const container = document.getElementById('recentActivities');
            if (!container) return;
            
            if (!atividades || atividades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h3>Nenhuma atividade recente</h3>
                        <p>As atividades aparecerão aqui</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            atividades.forEach(atividade => {
                const li = document.createElement('li');
                li.className = 'list-item';
                
                // Icone baseado no tipo
                let icon = '';
                let iconClass = '';
                switch(atividade.tipo) {
                    case 'cliente': 
                        icon = 'fa-user';
                        iconClass = 'var(--primary)';
                        break;
                    case 'orcamento': 
                        icon = 'fa-file-invoice-dollar';
                        iconClass = 'var(--success)';
                        break;
                    case 'ordem': 
                        icon = 'fa-clipboard-check';
                        iconClass = 'var(--warning)';
                        break;
                    case 'agendamento': 
                        icon = 'fa-calendar-alt';
                        iconClass = 'var(--secondary)';
                        break;
                    case 'pagamento':
                        icon = 'fa-money-bill-wave';
                        iconClass = 'var(--success)';
                        break;
                    default:
                        icon = 'fa-bell';
                }
                
                // Formatar data
                const data = new Date(atividade.data);
                const hora = data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const dataStr = data.toLocaleDateString('pt-BR');
                
                li.innerHTML = `
                    <div class="list-item-content">
                        <h3>${atividade.descricao}</h3>
                        <p>${atividade.clienteNome ? 'Cliente: ' + atividade.clienteNome : ''} • ${dataStr} ${hora}</p>
                        ${atividade.status ? `<span class="status status-${atividade.status}" style="font-size: 0.7rem; margin-top: 5px;">${atividade.status}</span>` : ''}
                    </div>
                    <div><i class="fas ${icon}" style="color: ${iconClass};"></i></div>
                `;
                
                container.appendChild(li);
            });
        }

        // ===== NOTIFICAÇÕES TOAST PREMIUM =====
        function showToast(message, type = 'info') {
            // Remover toasts anteriores
            const existingToasts = document.querySelectorAll('.toast-notification');
            existingToasts.forEach(toast => toast.remove());
            
            // Criar elemento toast
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            
            // Icone baseado no tipo
            let icon = 'fa-info-circle';
            switch(type) {
                case 'success': icon = 'fa-check-circle'; break;
                case 'error': icon = 'fa-exclamation-circle'; break;
                case 'warning': icon = 'fa-exclamation-triangle'; break;
                case 'info': icon = 'fa-info-circle'; break;
            }
            
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${message}</span>`;
            document.body.appendChild(toast);
            
            // Remover após 4 segundos
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        // ===== FUNÇÕES DE EXPORTAÇÃO/PDF (MANTIDAS) =====
        function downloadPDF(tipo, id) {
            if (tipo === 'orcamento') {
                downloadOrcamentoPDF(id);
            } else if (tipo === 'ordem') {
                downloadOrdemPDF(id);
            }
        }

        async function downloadOrcamentoPDF(id) {
            if (!db) return;
            
            const transaction = db.transaction(['orcamentos'], 'readonly');
            const store = transaction.objectStore('orcamentos');
            const request = store.get(id);
            
            request.onsuccess = async function() {
                const orcamento = request.result;
                if (!orcamento) return;
                
                // Buscar informações do cliente
                const clienteTransaction = db.transaction(['clientes'], 'readonly');
                const clienteStore = clienteTransaction.objectStore('clientes');
                const clienteRequest = clienteStore.get(orcamento.clienteId);
                
                clienteRequest.onsuccess = function() {
                    const clienteInfo = clienteRequest.result || {};
                    
                    // Usar jsPDF para gerar o PDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Configurações da página
                    const pageWidth = doc.internal.pageSize.width;
                    const margin = 20;
                    
                    // Cabeçalho com informações da empresa
                    doc.setFontSize(20);
                    doc.setTextColor(67, 97, 238);
                    doc.text(empresaInfo.nome, pageWidth / 2, 25, { align: 'center' });
                    
                    if (empresaInfo.slogan) {
                        doc.setFontSize(12);
                        doc.setTextColor(76, 201, 240);
                        doc.text(empresaInfo.slogan, pageWidth / 2, 33, { align: 'center' });
                    }
                    
                    // Linha separadora
                    doc.setDrawColor(67, 97, 238);
                    doc.setLineWidth(1);
                    doc.line(margin, 40, pageWidth - margin, 40);
                    
                    // Título do documento
                    doc.setFontSize(18);
                    doc.setTextColor(33, 37, 41);
                    doc.text(`ORÇAMENTO #${orcamento.id}`, pageWidth / 2, 50, { align: 'center' });
                    
                    // Informações do cliente
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Cliente: ${clienteInfo.nome || ''}`, margin, 65);
                    if (clienteInfo.endereco) {
                        doc.text(`Endereço: ${clienteInfo.endereco}`, margin, 72);
                    }
                    if (clienteInfo.telefone) {
                        doc.text(`Telefone: ${clienteInfo.telefone}`, margin, 79);
                    }
                    
                    // Informações da empresa
                    let empresaY = 65;
                    if (empresaInfo.telefone) {
                        doc.text(`Telefone: ${empresaInfo.telefone}`, pageWidth - margin, empresaY, { align: 'right' });
                        empresaY += 7;
                    }
                    if (empresaInfo.email) {
                        doc.text(`Email: ${empresaInfo.email}`, pageWidth - margin, empresaY, { align: 'right' });
                        empresaY += 7;
                    }
                    if (empresaInfo.cnpj) {
                        doc.text(`CNPJ: ${empresaInfo.cnpj}`, pageWidth - margin, empresaY, { align: 'right' });
                        empresaY += 7;
                    }
                    
                    // Data e validade
                    const data = new Date(orcamento.data);
                    const dataStr = data.toLocaleDateString('pt-BR');
                    const validadeData = new Date(data);
                    validadeData.setDate(validadeData.getDate() + orcamento.validade);
                    const validadeStr = validadeData.toLocaleDateString('pt-BR');
                    
                    doc.text(`Data: ${dataStr}`, margin, 95);
                    doc.text(`Validade: ${validadeStr} (${orcamento.validade} dias)`, margin, 102);
                    
                    // Serviços
                    doc.setFontSize(14);
                    doc.text('DESCRIÇÃO DOS SERVIÇOS', margin, 115);
                    
                    doc.setFontSize(11);
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.5);
                    doc.line(margin, 117, pageWidth - margin, 117);
                    
                    const servicosLines = doc.splitTextToSize(orcamento.servicos, pageWidth - 2 * margin);
                    doc.text(servicosLines, margin, 125);
                    
                    // Valor
                    const servicosHeight = servicosLines.length * 5;
                    const valorY = 130 + servicosHeight;
                    
                    doc.setFontSize(14);
                    doc.text('VALOR TOTAL', margin, valorY);
                    
                    doc.setFontSize(22);
                    doc.setTextColor(76, 201, 240);
                    doc.text(`R$ ${orcamento.valor.toFixed(2)}`, pageWidth - margin, valorY, { align: 'right' });
                    
                    // Observações
                    if (orcamento.observacoes) {
                        doc.setFontSize(14);
                        doc.setTextColor(0, 0, 0);
                        doc.text('OBSERVAÇÕES', margin, valorY + 15);
                        
                        doc.setFontSize(11);
                        const obsLines = doc.splitTextToSize(orcamento.observacoes, pageWidth - 2 * margin);
                        doc.text(obsLines, margin, valorY + 23);
                    }
                    
                    // Rodapé
                    const footerY = doc.internal.pageSize.height - 20;
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`Documento gerado em: ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR')}`, pageWidth / 2, footerY, { align: 'center' });
                    
                    // Salvar PDF
                    doc.save(`orcamento_${orcamento.id}_${empresaInfo.nome.replace(/\s+/g, '_')}.pdf`);
                    
                    showToast('PDF gerado com sucesso', 'success');
                    addAtividade('orcamento', 'PDF do orçamento gerado', clienteInfo.nome);
                };
            };
        }

        // ===== FUNÇÕES DE BACKUP (MANTIDAS) =====
        function exportBackup() {
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            const backupData = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                empresa: empresaInfo,
                settings: financialSettings
            };
            
            // Coletar todos os dados
            const stores = ['clientes', 'orcamentos', 'ordens', 'agendamentos', 'atividades', 'pagamentos', 'empresa'];
            let completed = 0;
            
            stores.forEach(storeName => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = function() {
                    backupData[storeName] = request.result || [];
                    completed++;
                    
                    if (completed === stores.length) {
                        // Criar arquivo JSON
                        const dataStr = JSON.stringify(backupData, null, 2);
                        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                        
                        // Criar link de download
                        const exportFileDefaultName = `cleansoft_backup_premium_${new Date().toISOString().split('T')[0]}.json`;
                        const linkElement = document.createElement('a');
                        linkElement.setAttribute('href', dataUri);
                        linkElement.setAttribute('download', exportFileDefaultName);
                        linkElement.click();
                        
                        showToast('Backup exportado com sucesso!', 'success');
                    }
                };
            });
        }

        function importBackup() {
            document.getElementById('importFileInput').click();
            document.getElementById('importFileInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const backupData = JSON.parse(event.target.result);
                        
                        if (!confirm(`Esta ação irá substituir todos os dados atuais. ${backupData.clientes ? backupData.clientes.length : 0} clientes, ${backupData.ordens ? backupData.ordens.length : 0} ordens e outros registros serão importados. Continuar?`)) {
                            return;
                        }
                        
                        restoreBackup(backupData);
                    } catch (error) {
                        showToast('Erro ao ler arquivo de backup', 'error');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            };
        }

        function restoreBackup(backupData) {
            if (!db) {
                showToast('Banco de dados não inicializado', 'error');
                return;
            }
            
            // Restaurar empresa info se existir
            if (backupData.empresa) {
                empresaInfo = backupData.empresa;
                
                const transaction = db.transaction(['empresa'], 'readwrite');
                const store = transaction.objectStore('empresa');
                store.put({
                    id: 'info',
                    data: empresaInfo,
                    updatedAt: new Date().toISOString()
                });
                
                // Atualizar interface
                setTimeout(() => {
                    loadEmpresaInfo();
                }, 500);
            }
            
            // Restaurar configurações financeiras
            if (backupData.settings) {
                Object.assign(financialSettings, backupData.settings);
            }
            
            // Restaurar dados de cada store
            const stores = ['clientes', 'orcamentos', 'ordens', 'agendamentos', 'atividades', 'pagamentos'];
            let completed = 0;
            let totalImported = 0;
            
            stores.forEach(storeName => {
                if (backupData[storeName]) {
                    const transaction = db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    
                    // Limpar store existente
                    store.clear();
                    
                    // Adicionar novos dados
                    backupData[storeName].forEach(item => {
                        store.add(item);
                        totalImported++;
                    });
                    
                    transaction.oncomplete = function() {
                        completed++;
                        if (completed === stores.length) {
                            showToast(`Backup restaurado com sucesso! ${totalImported} registros importados.`, 'success');
                            
                            // Recarregar dados
                            setTimeout(() => {
                                loadDashboardData();
                                loadClientes();
                                loadOrcamentos();
                                loadOrdens();
                                loadAgendamentos();
                                loadFinancialData();
                                updateDatabaseStats();
                            }, 1000);
                        }
                    };
                    
                    transaction.onerror = function() {
                        completed++;
                        console.error(`Erro ao restaurar ${storeName}`);
                    };
                } else {
                    completed++;
                }
            });
        }

        // ===== OUTRAS FUNÇÕES UTILITÁRIAS =====
        function countRecords(storeName, elementId) {
            if (!db) return;
            
            const transaction = db.transaction([storeName], 'readonly');
            const store = transaction.objectStore(storeName);
            const request = store.count();
            
            request.onsuccess = function() {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = request.result;
                }
            };
            
            request.onerror = function() {
                console.error('Erro ao contar registros:', storeName);
            };
        }

        function loadFilterOptions() {
            if (!db) return;
            
            // Carregar clientes para filtro de orçamentos
            const transaction = db.transaction(['clientes'], 'readonly');
            const store = transaction.objectStore('clientes');
            const request = store.getAll();
            
            request.onsuccess = function() {
                const clientes = request.result || [];
                const select = document.getElementById('filterClienteOrcamento');
                if (select) {
                    select.innerHTML = '<option value="">Todos os clientes</option>';
                    clientes.forEach(cliente => {
                        select.innerHTML += `<option value="${cliente.id}">${cliente.nome}</option>`;
                    });
                }
            };
        }

        // Inicializar dados fictícios para demonstração
        setTimeout(() => {
            if (document.getElementById('totalClientes').textContent === '0') {
                document.getElementById('totalClientes').textContent = '12';
                document.getElementById('receitaTotal').textContent = 'R$ 8.750,00';
                document.getElementById('totalOrdens').textContent = '5';
                document.getElementById('totalAgendamentos').textContent = '3';
                
                // Atualizar trends
                document.getElementById('clientesTrend').innerHTML = '<i class="fas fa-arrow-up"></i> <span>8%</span>';
                document.getElementById('receitaTrend').innerHTML = '<i class="fas fa-arrow-up"></i> <span>15%</span>';
                document.getElementById('ordensTrend').innerHTML = '<i class="fas fa-arrow-down"></i> <span>3%</span>';
                
                // Atualizar financeiro
                document.getElementById('receitaMes').textContent = 'R$ 2.850,00';
                document.getElementById('lucroMes').textContent = 'R$ 1.350,00';
                document.getElementById('pendentes').textContent = 'R$ 1.250,00';
                document.getElementById('despesas').textContent = 'R$ 1.500,00';
            }
        }, 2000);
    </script>
</body>
</html>
